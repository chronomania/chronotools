NOTES

   Read readme.html

THE REST OF THIS FILE IS MY NOTES

Ks transnotes.txt

----------------

darkforcelta apua:
   cmp #$80
   bcc _label_   { branch A < $80}
   bcs _label_   { branch A >= $80}
   beq _label_   { branch A = $80}
   bne _label_   { branch A != $80 }

   lda $7e2000
   bmi _label_   { branch if (A & $80) = $80 } (similar in 16-bit mode)
   bpl _label_   { branch if (A & $80) = $00 }

// DIALOGIN PIIRTO - ASSEMBLER

// Tästä hypätään ->C0:2126
$C0:2018 20 26 21    JSR [DB:$2126]       ;$00:2126     A:7700 X:07E0 Y:001F D:0100 DB:00 PB:C0
// Tämä on lause, johon 21A7 palaa.
$C0:201B 6B          RTL                                A:0001 X:0058 Y:0200 D:0100 DB:00 PB:C0

// Täällä tarkistetaan erikoiskoodeja.
//  215 = erikoiskoodi, asetettu muualla
$C0:2126 AD 15 02    LDA [DB:$0215]       ;$00:0215     A:7700 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2129 D0 03       BNE $212E                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
// Ei ollut 0
$C0:212E C9 09       CMP A, $09    eli CLS              A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2130 F0 2F       BEQ $2161                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2132 C9 0A       CMP A, $0A    eli CLS3             A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2134 F0 2B       BEQ $2161                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2136 C9 0B       CMP A, $0B    eli PAUSE            A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2138 F0 27       BEQ $2161                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:213A C9 0C       CMP A, $0C    eli PAUSE3           A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:213C F0 23       BEQ $2161                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:213E C9 05       CMP A, $05    eli NL               A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2140 F0 19       BEQ $215B                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2142 C9 06       CMP A, $06    eli NL3              A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2144 F0 15       BEQ $215B                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2146 C9 07       CMP A, $07    eli PAUSENL          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2148 F0 11       BEQ $215B                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:214A C9 08       CMP A, $08    eli PAUSENL3         A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:214C F0 0D       BEQ $215B                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:214E C9 03       CMP A, $03    eli DELAY            A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2150 F0 02       BEQ $2154                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2152 80 19       BRA $216D                          A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0

// 215B: newline-handler

// 2161: cls-handler

// 216D: muu merkki
//        0213: nyt tulostettavien merkkien määrä
$C0:216D A9 01       LDA A, $01                         A:7710 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:216F 8D 13 02    STA [DB:$0213]       ;$00:0213     A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C0:2172 22 09 00 C2 JSL [$C2:$0009]      ;$C2:0009     A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C0
$C2:0009 4C 23 58    JMP [DB:$5823]       ;$00:5823     A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C2

// 5823: merkin tulostusrutiini.
$C2:5823 08          PHP                                A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C2
$C2:5824 C2 20       REP $20                            A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C2
$C2:5826 0B          PHD                                A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C2
$C2:5827 A9 00 02    LDA A, $0200                       A:7701 X:07E0 Y:001F D:0100 DB:00 PB:C2
$C2:582A 5B          TCD                                A:0200 X:07E0 Y:001F D:0100 DB:00 PB:C2
$C2:582B A9 00 00    LDA A, $0000                       A:0200 X:07E0 Y:001F D:0200 DB:00 PB:C2
$C2:582E E2 20       SEP $20                            A:0000 X:07E0 Y:001F D:0200 DB:00 PB:C2
$C2:5830 20 4A 58    JSR DB:$584A         ;$00:584A     A:0000 X:07E0 Y:001F D:0200 DB:00 PB:C2
// jatkuu 5833:ssa
$C2:584A A5 15       LDA [$00:D+$15]      ;$00:0215     A:0000 X:07E0 Y:001F D:0200 DB:00 PB:C2
$C2:584C 0A          ASL A                              A:0010 X:07E0 Y:001F D:0200 DB:00 PB:C2
$C2:584D AA          TAX                                A:0020 X:07E0 Y:001F D:0200 DB:00 PB:C2
// x = merkki*2
// Taulun 5851 sisältö (merkeille 0x00..0x20):
// 0-7   5893 5895 5895 5895  5895 5897 589B 5897
// 8-F   589B 5897 589B 5897  589B 5895 5895 5895
// 10-17 5895 5895 5895 5895  5895 5895 5895 5895
// 18-1F 5895 5895 5895 5895  5895 5895 5895 5895
// 20    5895
//   5893 = ei tulosteta
//   5895 = tulostetaan sellaisenaan
//   5897 = erikoismerkki
//   589B = erikoismerkki, lisäksi kolme spacea

$C2:584E 7C 51 58    JMP [PB:word[PB:$5851+x]] ;$C2:5895 A:0020 X:0020 Y:001F D:0200 DB:00 PB:C
$C2:5895 80 19       BRA $58B0                          A:0020 X:0020 Y:001F D:0200 DB:00 PB:C2
$C2:58B0 18          CLC                                A:0020 X:0020 Y:001F D:0200 DB:00 PB:C2
$C2:58B1 60          RTS                                A:0020 X:0020 Y:001F D:0200 DB:00 PB:C2
// Hyppy 58B2:n ohi, jos carry set
$C2:5833 B0 07       BCS $583C                          A:0020 X:0020 Y:001F D:0200 DB:00 PB:C2
// $230:sta haetaan ohje!
$C2:5835 A5 30       LDA [$00:D+$30]      ;$00:0230     A:0020 X:0020 Y:001F D:0200 DB:00 PB:C2
$C2:5837 0A          ASL A                              A:0000 X:0020 Y:001F D:0200 DB:00 PB:C2
$C2:5838 AA          TAX                                A:0000 X:0020 Y:001F D:0200 DB:00 PB:C2
// Taulun 5842 sisältö:
//  0-1   58B2 = haetaan merkki
//        5BF5 = tulostetaan edellinen merkki
$C2:5839 FC 42 58    JSR [PB:word[PB:$5842+x]] ;$C2:58B2 A:0000 X:0000 Y:001F D:0200 DB:00 PB:C
// 583C: mitä lie?
$C2:583C A9 00       LDA A, $00                         A:0010 X:0022 Y:02A0 D:0200 DB:00 PB:C2
$C2:583E EB          XBA                                A:0000 X:0022 Y:02A0 D:0200 DB:00 PB:C2
$C2:583F 2B          PLD                                A:0000 X:0022 Y:02A0 D:0200 DB:00 PB:C2
$C2:5840 28          PLP                                A:0000 X:0022 Y:02A0 D:0100 DB:00 PB:C2
$C2:5841 6B          RTL                                A:0000 X:0022 Y:02A0 D:0100 DB:00 PB:C2
// merkin tulostusrutiini loppuu tähän.

$C2:5893 38          SEC                                A:0000 X:08B3 Y:0038 D:0000 DB:00 PB:7E S:06FF P:envmxdIZC HC:010 VC:225 02
$C2:5894 60          RTS                                A:0000 X:08B3 Y:0038 D:0000 DB:00 PB:7E S:06FF P:envmxdIZC HC:010 VC:225 02

// Haetaan merkki pointterin osoittamasta paikasta
$C2:58B2 A7 31       LDA [long[D+$31]]    ;$F7:531D     A:0000 X:0000 Y:001F D:0200 DB:00 PB:C2
// Kasvatetaan merkkijonopointteria
$C2:58B4 C2 20       REP $20                            A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58B6 E6 31       INC [$00:D+$31]      ;$00:0231     A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58B8 E2 20       SEP $20                            A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
// Jos lukuarvo on alle 0xA0...
$C2:58BA C9 A0       CMP A, $A0                         A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58BC 90 12       BCC $58D0                          A:003D X:0000 Y:001F D:0200 DB:00 PB:C2

// Merkki oli siis >= 0xA0. Tulostetaan se!
;Tähän päädytään myös, jos merkki oli $01/$02...
$C2:58BE C2 20       REP $20                            A:00F8 X:0000 Y:001F D:0200 DB:00 PB:C2
; Talteen 16-bittisenä
$C2:58C0 85 35       STA [$00:D+$35]      ;$00:0235     A:00F8 X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58C2 E2 20       SEP $20                            A:00F8 X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58C4 20 C4 5D    JSR [DB:$5DC4]       ;$00:5DC4     A:00F8 X:0000 Y:001F D:0200 DB:00 PB:C2

// Kun merkki on tulostettu, vähennetään jotain laskuria (?)
$C2:58C7 C6 13       DEC [$00:D+$13]      ;$00:0213     A:0000 X:002E Y:0050 D:0200 DB:00 PB:C2
// Jos merkkejä on yhä jäljellä, tulostetaan seuraava.
$C2:58C9 D0 E7       BNE $58B2                          A:0000 X:002E Y:0050 D:0200 DB:00 PB:C2
// Sijoitetaan $10 seuraavaksi tulostettavaksi merkiksi.
$C2:58CB A9 10       LDA A, $10                         A:0000 X:002E Y:0050 D:0200 DB:00 PB:C2
$C2:58CD 85 15       STA [$00:D+$15]      ;$00:0215     A:0010 X:002E Y:0050 D:0200 DB:00 PB:C2
$C2:58CF 60          RTS                                A:0010 X:002E Y:0050 D:0200 DB:00 PB:C2
// Tämä on matkalla pois tulostusrutiinista.



// Jossain korkeammalla tasolla on tällainen:
// Jos se seuraava tulostettava merkki on 0...
$C0:2176 AD 15 02    LDA [DB:$0215]       ;$00:0215     A:0000 X:0058 Y:0200 D:0100 DB:00 PB:C0
$C0:2179 F0 58       BEQ $21D3                          A:0010 X:0058 Y:0200 D:0100 DB:00 PB:C0
// Jos se on 0x10?
$C0:217B C9 10       CMP A, $10                         A:0010 X:0058 Y:0200 D:0100 DB:00 PB:C0
$C0:217D F0 24       BEQ $21A3                          A:0010 X:0058 Y:0200 D:0100 DB:00 PB:C0
// Veikkaan, että 217F on [pause]-käsittelijä.
$C0:21A3 A9 01       LDA A, $01                         A:0010 X:0058 Y:0200 D:0100 DB:00 PB:C0
$C0:21A5 85 36       STA [$00:D+$36]      ;$00:0136     A:0001 X:0058 Y:0200 D:0100 DB:00 PB:C0
$C0:21A7 60          RTS                                A:0001 X:0058 Y:0200 D:0100 DB:00 PB:C0

// Jos arvo oli 0, rutiini loppuu tähän.
$C0:21D3 A2 FF FF    LDX $FFFF                          A:0000 X:0000 Y:0000 D:0100 DB:00 PB:C0
$C0:21D6 86 34       STX [$00:D+$34]      ;$00:0134     A:0000 X:FFFF Y:0000 D:0100 DB:00 PB:C0
$C0:21D8 A9 07       LDA A, $07                         A:0000 X:FFFF Y:0000 D:0100 DB:00 PB:C0
$C0:21DA 85 29       STA [$00:D+$29]      ;$00:0129     A:0007 X:FFFF Y:0000 D:0100 DB:00 PB:C0
$C0:21DC A9 81       LDA A, $81                         A:0007 X:FFFF Y:0000 D:0100 DB:00 PB:C0
$C0:21DE 85 36       STA [$00:D+$36]      ;$00:0136     A:0081 X:FFFF Y:0000 D:0100 DB:00 PB:C0
$C0:21E0 60          RTS                                A:0081 X:FFFF Y:0000 D:0100 DB:00 PB:C0




// Tänne saavutaan, jos merkki oli alle 0xA0. Jos se on alle 0x21 myös...
$C2:58D0 C9 21       CMP A, $21                         A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58D2 90 29       BCC $58FD                          A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
// Ei ollut, joten tallennetaan se temppipaikkaan
$C2:58D4 85 3B       STA [$00:D+$3B]      ;$00:023B     A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58D6 38          SEC                                A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58D7 E9 21       SBC A, $21                         A:003D X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58D9 0A          ASL A                              A:001C X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58DA AA          TAX                                A:0038 X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58DB C2 20       REP $20                            A:0038 X:0038 Y:001F D:0200 DB:00 PB:C2
;Seuraavassa tapahtuu näin:
;   $0237[long] <- pointteri dictionary-sanaan
;   $023A[byte] <- dictionary-sanan pituus
;   $0230[byte] <- $01
;   Hyppy $5BF5
$C2:58DD BF 00 FA DE LDA [$DE:$FA00+x]    ;$DE:FA38     A:0038 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58E1 85 37       STA [$00:D+$37]      ;$00:0237     A:FB4B X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58E3 A9 00 00    LDA A, $0000                       A:FB4B X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58E6 E2 20       SEP $20                            A:0000 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58E8 A9 DE       LDA A, $DE                         A:0000 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58EA 85 39       STA [$00:D+$39]      ;$00:0239     A:00DE X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58EC A7 37       LDA [long[D+37]]     ;$DE:FB4B     A:00DE X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58EE 85 3A       STA [$00:D+$3A]      ;$00:023A     A:0002 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58F0 C2 20       REP $20                            A:0002 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58F2 E6 37       INC [$00:D+$37]      ;$00:0237     A:0002 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58F4 E2 20       SEP $20                            A:0002 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58F6 A9 01       LDA A, $01                         A:0002 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58F8 85 30       STA [$00:D+$30]      ;$00:0230     A:0001 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:58FA 4C F5 5B    JMP [DB:$5BF5]       ;$00:5BF5     A:0001 X:0038 Y:001F D:0200 DB:00 PB:C2

// Tänne saavutaan, jos merkki oli < 0x21.
// Koskee kaikkia skriptistä löytyviä merkkejä,
// niin 0x20=Epoch kuin 0x05=NL myös.
$C2:58FD A8          TAY                                A:0013 X:0000 Y:001F D:0200 DB:00 PB:C2
$C2:58FE 0A          ASL A                              A:0013 X:0000 Y:0013 D:0200 DB:00 PB:C2
$C2:58FF AA          TAX                                A:0026 X:0000 Y:0013 D:0200 DB:00 PB:C2
$C2:5900 7C 03 59    JMP [PB:word[PB:$5903+x]]  ;$C2:5B15 A:0026 X:0026 Y:0013 D:0200 DB:00 PB:
// Taulun C2:5903 sisältö:
//  0-7:     594F 5B06 5B06 5945  594F 594F 594F 594F 
//  8-F:     594F 594F 594F 594F  594F 5953 5985 59C8
// 10-17:    5B14 5A26 5A4C 5B15  5B15 5B15 5B15 5B15
// 18-1F:    5B15 5B15 5B3B 5B70  5B70 5B70 5B56 5B9B
// 20:       5BD6
//  * 5B06: 1/2      (fonttilaajennus??)
//    5945: delay
//    594F: nl/pausenl/cls/pause/nul
//    5953: num8
//    5985: num16
//    59C8: num32
//  * 5B14: #$10         
//  * 5A26: member
//  * 5A4C: tech/monster
//  * 5B15: player name
//  * 5B3B: crononick
//  * 5B70: member #n
//    5B56: Nadia
//  * 5B9B: item
//  * 5BD6: Epoch

// NUM16-käsittelijä:
$C2:5985 C2 20       REP $20                            A:001C X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envMxdizc HC:014 VC:076 00
$C2:5987 A7 3D       LDA [long[$00:D+$3D]] ;$00:0201    A:001C X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envmxdizc HC:032 VC:076 00
;Hakee sen kyseisen luvun (16-bit).
$C2:5989 85 68       STA [$00:D+$68]      ;$00:0268     A:003C X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envmxdizc HC:084 VC:076 00
;Muuttaa pointteria osoittamaan seuraavaan lukuun.
$C2:598B E6 3D       INC [$00:D+$3D]      ;$00:023D     A:003C X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envmxdizc HC:112 VC:076 00
$C2:598D E6 3D       INC [$00:D+$3D]      ;$00:023D     A:003C X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envmxdizc HC:162 VC:076 00
$C2:598F A9 00 00    LDA A, $0000                       A:003C X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envmxdizc HC:212 VC:076 00
$C2:5992 E2 20       SEP $20                            A:0000 X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envmxdiZc HC:230 VC:076 00
$C2:5994 A5 A1       LDA [$00:D+$A1]      ;$00:02A1     A:0000 X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envMxdiZc HC:248 VC:076 00
$C2:5996 D0 15       BNE $59AD                          A:0000 X:001C Y:000E D:0200 DB:7E PB:C2 S:06C4 P:envMxdiZc HC:268 VC:076 00
;jne....

// [tech]/[monster]-KÄSITTELIJÄ.
;Hakee seuraavan tavun.
$C2:5A4C A7 31       LDA [long[$00:D+$31]] ;$CE:EF5D    A:0024 X:0024 Y:0012 D:0200 DB:7E PB:C2
$C2:5A4E C2 20       REP $20                            A:0001 X:0024 Y:0012 D:0200 DB:7E PB:C2
$C2:5A50 E6 31       INC [$00:D+$31]      ;$00:0231     A:0001 X:0024 Y:0012 D:0200 DB:7E PB:C2
$C2:5A52 E2 20       SEP $20                            A:0001 X:0024 Y:0012 D:0200 DB:7E PB:C2
;Jos se on <8
$C2:5A54 C9 08       CMP A, $08                         A:0001 X:0024 Y:0012 D:0200 DB:7E PB:C2
$C2:5A56 90 2D       BCC $5A85                          A:0001 X:0024 Y:0012 D:0200 DB:7E PB:C2

// Jos [tech]:n jälkeen tuleva merkki oli >= 8
$C2:5A5A 38          SEC                            
$C2:5A5B E9 08       SBC A, $08                     
; Vähennetään 8
$C2:5A5D C2 20       REP $20                        
$C2:5A5F 18          CLC                            
; Lisätään $1F
$C2:5A60 69 1F 00    ADC A, $001F                   
$C2:5A63 0A          ASL A                          
$C2:5A64 AA          TAX                            
; Ja haetaan dictionarystä!!
$C2:5A65 BF 00 FA DE LDA [$DE:$FA00+x]    ;$DE:FA24 
; Loppuosa on täsmälleen sama kuin 58E1:ssä!
$C2:5A69 85 37       STA [$00:D+$37]      ;$00:0237 
$C2:5A6B A9 00 00    LDA A, $0000                   
$C2:5A6E E2 20       SEP $20                        
$C2:5A70 A9 DE       LDA A, $DE                     
$C2:5A72 85 39       STA [$00:D+$39]      ;$00:0239 
$C2:5A74 A7 37       LDA [long[$00:D+$37]] ;$FF:30D7
$C2:5A76 85 3A       STA [$00:D+$3A]      ;$00:023A 
$C2:5A78 C2 20       REP $20                        
$C2:5A7A E6 37       INC [$00:D+$37]      ;$00:0237 
$C2:5A7C E2 20       SEP $20                        
$C2:5A7E A9 01       LDA A, $01                     
$C2:5A80 85 30       STA [$00:D+$30]      ;$00:0230 
$C2:5A82 4C F5 5B    JMP DB:$5BF5         ;$7E:5BF5 


; [tech] jälkeen tuli < 8
$C2:5A85 0A          ASL A                              A:0001 X:0024 Y:0012 D:0200 DB:7E PB:C2
$C2:5A86 AA          TAX                                A:0002 X:0024 Y:0012 D:0200 DB:7E PB:C2
$C2:5A87 7C 8A 5A    JMP [PB:word[PB:$5A8A+x]] ;$C2:5AD0 A:0002 X:0002 Y:0012 D:0200 DB:7E PB:C
// Taulun sisältö:
//      5A8E 5AD0

// 01/02 -KÄSITTELIJÄ.
// Lataa skriptistä seuraavan merkin ja tulostaa sen sellaisenaan.
$C2:5B06 98          TYA                            
$C2:5B07 EB          XBA                            
$C2:5B08 A7 31       LDA [long[$00:D+$31]] ;$CC:3C14
$C2:5B0A C2 20       REP $20                        
$C2:5B0C EE 31 02    INC DB:$0231         ;$7E:0231 
$C2:5B0F E2 20       SEP $20                        
;Hyppy normaalin merkin käsittelijään
$C2:5B11 4C BE 58    JMP DB:$58BE         ;$7E:58BE 

;Tähän päädytään, jos merkki oli $10 kohdassa $C2:5900
$C2:5B14 60          RTS

// [monster]-KÄSITTELIJÄ 5AD0-5B05
;Sisältö:
;   Haetaan monsterin numero (lda [long[$00:D+$3D]])
;   Päivitetään pointteria: inc [$00:D+$3D]
;   $0237[long] <- pointteri monsterin nimeen
;   $023A[byte] <- monsterin nimen pituus
;   $0230[byte] <- $01
;   Hyppy $5BF5

// [tech]-KÄSITTELIJÄ 5A8E-5ACF
;Sisältö:
;   Haetaan techin numero (lda [long[$00:D+$3D]])
;   Päivitetään pointteria: inc [$00:D+$3D]
;   $0237[long] <- pointteri techin nimeen (jos eka merkki on tähti ($2F), se pois)
;   $023A[byte] <- techin nimen pituus
;   $0230[byte] <- $01
;   Hyppy $5BF5

// [item]-KÄSITTELIJÄ 5B9B-5BD5
;Sisältö:
;   Haetaan itemin numero (lda $7F:$0200)
;   $0237[long] <- pointteri itemin nimeen (skipataan eka merkki)
;   $023A[byte] <- itemin nimen pituus
;   $0230[byte] <- $01
;   Hyppy $5BF5

// [member]-KÄSITTELIJÄ 5A26-5A4B:
;Sisältö:
;   Haetaan hahmon numero (lda [long[$00:D+$3D]])
;   Päivitetään pointteria: inc [$00:D+$3D]
;   $0237[long] <- pointteri hahmon nimeen (taulusta $C2:5FD8); segmentti $7E
;   $023A[byte] <- hahmon nimen pituus
;   $0230[byte] <- $01
;   Hyppy $5BF5

//  player-KÄSITTELIJÄ 5B15-5B3A
;Sisältö:
;   Haetaan hahmon numero (Y-$13)
;   $0237[long] <- pointteri hahmon nimeen (taulusta $C2:5FD8); segmentti $7E
;   $023A[byte] <- hahmon nimen pituus
;   $0230[byte] <- $01 (merkintä "merkkejä jäljellä")
;   Hyppy $5BF5

//   CRONONICK-KÄSITTELIJÄ 5B3B-5B55
;Sisältö:
;   $0237[long] <- pointteri Cronon nimeen: $7E:$2C23
;   $023A[byte] <- hahmon nimen pituus
;   $0230[byte] <- $01 (merkintä "merkkejä jäljellä")
;   Hyppy $5BF5

//   EPOCH-KÄSITTELIJÄ 5BD6-5BF4
;Sisältö:
;   $0237[long] <- pointteri Epochin nimeen: $7E:$2C4D
;   $023A[byte] <- hahmon nimen pituus
;   $0230[byte] <- $01 (merkintä "merkkejä jäljellä")
;   Hyppy $5BF5

//  [member #]-KÄSITTELIJÄ 5B70-5B9A
;Sisältö:
;   Haetaan jäsenen numero (Y-$1B)
;   Haetaan hahmon numero [$7E:$2980 + jäsen]
;   $0237[long] <- pointteri hahmon nimeen (taulusta $C2:5FD8); segmentti $7E
;   $023A[byte] <- hahmon nimen pituus
;   $0230[byte] <- $01 (merkintä "merkkejä jäljellä")
;   Hyppy $5BF5



// Tänne päädytään, kun on jokin 12pix-merkki, joka selvästi voidaan tulostaa.
// Syöte:
//   $0237[long] = pointteri merkkijonoon
//   $023A[byte] = merkkijonon pituus MERKKEINÄ (ei tavuina)
//   $0213[byte] = Joku laskuri
// Käyttää:
//   $0235[word] = merkki
// Tuote:
//   $0215[byte] = Joku status-lippu: arvo voi olla $10
//   $0230[byte] = 0 jos skripti loppui, muuten ei muuteta

// Haetaan merkki.
$C2:5BF5 A7 37       LDA [long[D+37]]     ;$DE:FB4C     A:0001 X:0038 Y:001F D:0200 DB:00 PB:C2
// Kasvatetaan pointteria
$C2:5BF7 C2 20       REP $20                            A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:5BF9 E6 37       INC [$00:D+$37]      ;$00:0237     A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:5BFB E2 20       SEP $20                            A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
// Tapaus c==0x01
$C2:5BFD C9 01       CMP A, $01                         A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:5BFF F0 04       BEQ $5C05                          A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
// Tapaus c==0x02
$C2:5C01 C9 02       CMP A, $02                         A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:5C03 D0 07       BNE $5C0C                          A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2

;Oli $01 tai $02
$C2:5C05 EB          XBA                                A:0001 X:0002 Y:001F D:0200 DB:00 S:06F2 P:envMxdi
;Hakee lowbyten
$C2:5C06 A7 37       LDA [long[D+$37]]                  A:0100 X:0002 Y:001F D:0200 DB:00 S:06F2 P:envMxdi
$C2:5C08 C2 20       REP #$20                           A:0102 X:0002 Y:001F D:0200 DB:00 S:06F2 P:envMxdi
;Kasvattaa pointteria
$C2:5C0A E6 37       INC [$00:D+$37]                    A:0102 X:0002 Y:001F D:0200 DB:00 S:06F2 P:envmxdi
// Nyt merkki on 16-bittinen. Talteen se.
$C2:5C0C C2 20       REP $20                            A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:5C0E 85 35       STA [$00:D+$35]      ;$00:0235     A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
$C2:5C10 E2 20       SEP $20                            A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
// Piirretään merkki.
$C2:5C12 20 C4 5D    JSR [DB:$5DC4]       ;$00:5DC4     A:00C8 X:0038 Y:001F D:0200 DB:00 PB:C2
// Tästä jatketaan.
$C2:5C15 A9 00       LDA A, $00                         A:0000 X:0028 Y:0050 D:0200 DB:00 PB:C2
// Vähennetään merkkijonon pituutta yhdellä
$C2:5C17 C6 3A       DEC [$00:D+$3A]      ;$00:023A     A:0000 X:0028 Y:0050 D:0200 DB:00 PB:C2
// Jos merkkijono loppui?
$C2:5C19 F0 02       BEQ $5C1D                          A:0000 X:0028 Y:0050 D:0200 DB:00 PB:C2
// Ei loppunut.
$C2:5C1B 09 01       ORA A, $01                         A:0000 X:0028 Y:0050 D:0200 DB:00 PB:C2
// Onko merkkejä jäljellä jonossa? ????
$C2:5C1D C6 13       DEC [$00:D+$13]      ;$00:0213     A:0001 X:0028 Y:0050 D:0200 DB:00 PB:C2
$C2:5C1F F0 02       BEQ $5C23                          A:0001 X:0028 Y:0050 D:0200 DB:00 PB:C2
$C2:5C21 09 02       ORA A, $02
// Ei ole.
$C2:5C23 0A          ASL A                              A:0001 X:0028 Y:0050 D:0200 DB:00 PB:C2
$C2:5C24 AA          TAX                                A:0002 X:0028 Y:0050 D:0200 DB:00 PB:C2
// Taulun 5C28 sisältö:
//   5C30 5C32 5C37 5C64
$C2:5C25 7C 28 5C    JMP [PB:word[PB:$5C28+x]]  ;$C2:5C32 A:0002 X:0002 Y:0050 D:0200 DB:00 PB:
// Merkitään lippu "seuraava merkki pitää hakea"
$C2:5C30 64 30       STZ [$00:D+$30]      ;$00:0230     A:0000 X:0000 Y:00A0 D:0200 DB:00 PB:C2
// Ja paluuarvoksi "skriptin tulostus jatkuu".
$C2:5C32 A9 10       LDA A, $10                         A:0000 X:0000 Y:00A0 D:0200 DB:00 PB:C2
$C2:5C34 85 15       STA [$00:D+$15]      ;$00:0215     A:0010 X:0000 Y:00A0 D:0200 DB:00 PB:C2
$C2:5C36 60          RTS                                A:0010 X:0000 Y:00A0 D:0200 DB:00 PB:C2
// ?
$C2:5C37 64 30       STZ [$00:D+$30]      ;$00:0230
$C2:5C39 4C B2 58    JMP DB:$58B2         ;$C2:58B2
// ?
$C2:5C64 5C 70 5C 75 JMP $75:$5C70


*** TÄSTÄ ALKAA DIALOGIFONTIN PIIRTORUTIINI ***

// 5DC4: piirtää merkin, joka on osoitteessa $00:0235.
// Tänne päädytään kahdesta osoitteesta:
//  - C2:5C12 (substring)
//  - C2:58C4 (literal)
//  PARAMETREJÄ:
//    $0210: (long) osoitin pikselibufferin alkuun
//    $0214: (byte) ???
//    $0217: (byte) tulostettujen merkkien määrä (tälle vain tehdään INC)
//    $0234: (byte) pikselipositio rivillä
//    $0235: (word) merkki, joka piirretään
//  PAIKALLISIA:
//    $0262: (byte) merkin järjestysnumero fontissa, alemmat 8 bittiä
//    $0263: (word) tähän koostetaan bittejä
//    $026A: (word) pikselipositio rivillä AND 7
//    $026C: (word) apumuuttuja laskutoimituksiin
//    $026E: (word) tavuoffset nametableen
//    $0276: (long) pointteri merkkiin fontissa, part 1
//    $0279: (long) pointteri merkkiin fontissa, part 2
//  PALUUARVO:
//    A = $0000

$C2:5DC4 C2 20       REP $20                            A:00EF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DC6 A5 35       LDA [$00:D+$35]      ;$00:0235     A:00EF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DC8 0A          ASL A                              A:00EF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DC9 0A          ASL A                              A:01DE X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DCA 0A          ASL A                              A:03BC X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DCB 85 6C       STA [$00:D+$6C]      ;$00:026C     A:0778 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DCD 0A          ASL A                              A:0778 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DCE 65 6C       ADC [$00:D+$6C]      ;$00:026C     A:0EF0 X:0000 Y:0030 D:0200 DB:7E PB:C2
// merkki*8 + merkki*16. A on nyt 24*merkki.
$C2:5DD0 18          CLC                                A:1668 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DD1 69 60 20    ADC A, $2060                       A:1668 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Lisätään fontin osoite.
$C2:5DD4 85 76       STA [$00:D+$76]      ;$00:0276     A:36C8 X:0000 Y:0030 D:0200 DB:7E PB:C2
// $0276 sisältää nyt pointterin fonttiin...
$C2:5DD6 A5 35       LDA [$00:D+$35]      ;$00:0235     A:36C8 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DD8 4A          LSR A                              A:00EF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DD9 0A          ASL A                              A:0077 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DDA 0A          ASL A                              A:00EE X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DDB 0A          ASL A                              A:01DC X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DDC 85 6C       STA [$00:D+$6C]      ;$00:026C     A:03B8 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DDE 0A          ASL A                              A:03B8 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DDF 65 6C       ADC [$00:D+$6C]      ;$00:026C     A:0770 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DE1 18          CLC                                A:0B28 X:0000 Y:0030 D:0200 DB:7E PB:C2
// A = (merkki/2)*24
$C2:5DE2 69 60 38    ADC A, $3860                       A:0B28 X:0000 Y:0030 D:0200 DB:7E PB:C2
// $0279 sisältää nyt pointterin fonttiin (osa 2).
$C2:5DE5 85 79       STA [$00:D+$79]      ;$00:0279     A:4388 X:0000 Y:0030 D:0200 DB:7E PB:C2
// $0234 saattaa olla pikselipositio rivillä.
$C2:5DE7 A5 34       LDA [$00:D+$34]      ;$00:0234     A:4388 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DE9 29 07 00    AND A, $0007                       A:EF00 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Sijoitetaan $026A:han se.
$C2:5DEC 85 6A       STA [$00:D+$6A]      ;$00:026A     A:0000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// $0210 sisältää pointterin tiletableen.
$C2:5DEE A5 10       LDA [$00:D+$10]      ;$00:0210     A:0000 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DF0 18          CLC                                A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DF1 69 08 00    ADC A, $0008                       A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Lisättiin 8.
// $0273 on seuraavan tilen osoite? (long)
$C2:5DF4 85 73       STA [$00:D+$73]      ;$00:0273     A:7008 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DF6 E2 20       SEP $20                            A:7008 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DF8 A5 12       LDA [$00:D+$12]      ;$00:0212     A:7008 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DFA 85 75       STA [$00:D+$75]      ;$00:0275     A:707E X:0000 Y:0030 D:0200 DB:7E PB:C2
// tämä segmentti fonttiin
$C2:5DFC A9 FF       LDA A, $FF                         A:707E X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5DFE 85 78       STA [$00:D+$78]      ;$00:0278     A:70FF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E00 85 7B       STA [$00:D+$7B]      ;$00:027B     A:70FF X:0000 Y:0030 D:0200 DB:7E PB:C2
// Haetaan merkkipositio (rivillä / 8) * 2
$C2:5E02 A5 34       LDA [$00:D+$34]      ;$00:0234     A:70FF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E04 29 F8       AND A, $F8                         A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E06 4A          LSR A                              A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E07 4A          LSR A                              A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Sijoitetaan -> $026E
$C2:5E08 85 6E       STA [$00:D+$6E]      ;$00:026E     A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Nolla -> $026F
$C2:5E0A 64 6F       STZ [$00:D+$6F]      ;$00:026F     A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Kopioidaan $236 -> $262
$C2:5E0C A5 35       LDA [$00:D+$35]      ;$00:0235     A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E0E 85 62       STA [$00:D+$62]      ;$00:0262     A:70EF X:0000 Y:0030 D:0200 DB:7E PB:C2
// $0214 = ???
$C2:5E10 A5 14       LDA [$00:D+$14]      ;$00:0214     A:70EF X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E12 29 0F       AND A, $0F                         A:7080 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E14 D0 05       BNE $5E1B                          A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// Piirretään!!!
$C2:5E16 20 36 5E    JSR DB:$5E36  - MUODOSTAMAAN TILE
// Nyt piirretty. ??
$C2:5E19 80 03       BRA $5E1E                          A:0000 X:0000 Y:0000 D:0200 DB:7E PB:C2
;Tänne ei jostain syystä päädytä koskaan!
$C2:5E1B 20 07 5F    JSR DB:$5F07  - ?
;Tähän hypättiin
$C2:5E1E A9 00       LDA A, $00                         A:0000 X:0000 Y:0000 D:0200 DB:7E PB:C2
$C2:5E20 EB          XBA                                A:0000 X:0000 Y:0000 D:0200 DB:7E PB:C2
$C2:5E21 38          SEC                                A:0000 X:0000 Y:0000 D:0200 DB:7E PB:C2
$C2:5E22 A5 35       LDA [$00:D+$35]      ;$00:0235     A:0000 X:0000 Y:0000 D:0200 DB:7E PB:C2
$C2:5E24 E9 A0       SBC A, $A0                         A:00EF X:0000 Y:0000 D:0200 DB:7E PB:C2
$C2:5E26 AA          TAX                                A:004F X:0000 Y:0000 D:0200 DB:7E PB:C2
$C2:5E27 18          CLC                                A:004F X:004F Y:0000 D:0200 DB:7E PB:C2
// 60E6 on taulu merkkien leveyksistä!
$C2:5E28 BF E6 60 C2 LDA $C2:($60E6+x)    ;$C2:6135     A:004F X:004F Y:0000 D:0200 DB:7E PB:C2
$C2:5E2C 65 34       ADC [$00:D+$34]      ;$00:0234     A:0004 X:004F Y:0000 D:0200 DB:7E PB:C2
$C2:5E2E 85 34       STA [$00:D+$34]      ;$00:0234     A:0004 X:004F Y:0000 D:0200 DB:7E PB:C2
$C2:5E30 E6 17       INC [$00:D+$17]      ;$00:0217     A:0004 X:004F Y:0000 D:0200 DB:7E PB:C2
$C2:5E32 A9 00       LDA A, $00                         A:0004 X:004F Y:0000 D:0200 DB:7E PB:C2
$C2:5E34 EB          XBA                                A:0000 X:004F Y:0000 D:0200 DB:7E PB:C2
$C2:5E35 60          RTS                                A:0000 X:004F Y:0000 D:0200 DB:7E PB:C2

*** TÄHÄN LOPPUU DIALOGIFONTIN PIIRTORUTIINI ***

*** TÄSTÄ ALKAA DIALOGIFONTIN TILENMUODOSTUKSEN APURUTIINI ***

// Rutiini 5E36: 
$C2:5E36 8B          PHB                                A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
// DB-rekisterin arvoksi $C2 (syy?)
$C2:5E37 A9 C2       LDA A, $C2                         A:7000 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E39 48          PHA                                A:70C2 X:0000 Y:0030 D:0200 DB:7E PB:C2
$C2:5E3A AB          PLB                                A:70C2 X:0000 Y:0030 D:0200 DB:7E PB:C2

$C2:5E3B A9 04       LDA A, $04                         A:70C2 X:0000 Y:0030 D:0200 DB:C2 PB:C2
$C2:5E3D 85 68       STA [$00:D+$68]      ;$00:0268     A:7004 X:0000 Y:0030 D:0200 DB:C2 PB:C2
// Nollataan tavulaskuri...
$C2:5E3F 64 60       STZ [$00:D+$60]      ;$00:0260     A:7004 X:0000 Y:0030 D:0200 DB:C2 PB:C2
$C2:5E41 64 61       STZ [$00:D+$61]      ;$00:0261     A:7004 X:0000 Y:0030 D:0200 DB:C2 PB:C2
//// FOR TMP0268 = 1 TO 4

// Tämä kahdesti:
$C2:5E43 20 89 5E    JSR DB:$5E89         ;$C2:5E89     A:7004 X:0000 Y:0030 D:0200 DB:C2 PB:C2
$C2:5E46 C2 20       REP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E48 E6 60       INC [$00:D+$60]      ;$00:0260     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E4A E6 73       INC [$00:D+$73]      ;$00:0273     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E4C E2 20       SEP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2

$C2:5E4E 20 89 5E    JSR DB:$5E89         ;$C2:5E89     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E51 C2 20       REP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E53 E6 60       INC [$00:D+$60]      ;$00:0260     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E55 E6 73       INC [$00:D+$73]      ;$00:0273     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E57 E2 20       SEP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2

$C2:5E59 C6 68       DEC [$00:D+$68]      ;$00:0268     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E5B D0 E6       BNE $5E43                          A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
//// NEXT

$C2:5E5D C2 20       REP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E5F A5 73       LDA [$00:D+$73]      ;$00:0273     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E61 18          CLC                                A:7010 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E62 69 F0 00    ADC A, $00F0                       A:7010 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E65 85 73       STA [$00:D+$73]      ;$00:0273     A:7100 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E67 E2 20       SEP $20                            A:7100 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E69 A9 08       LDA A, $08                         A:7100 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E6B 85 68       STA [$00:D+$68]      ;$00:0268     A:7108 X:0000 Y:0000 D:0200 DB:C2 PB:C2
//// FOR TMP0268 = 1 TO 8

// Tämä kahdesti täälläkin:
$C2:5E6D 20 89 5E    JSR DB:$5E89         ;$C2:5E89     A:7108 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E70 C2 20       REP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E72 E6 60       INC [$00:D+$60]      ;$00:0260     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E74 E6 73       INC [$00:D+$73]      ;$00:0273     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E76 E2 20       SEP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2

$C2:5E78 20 89 5E    JSR DB:$5E89         ;$C2:5E89     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E7B C2 20       REP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E7D E6 60       INC [$00:D+$60]      ;$00:0260     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E7F E6 73       INC [$00:D+$73]      ;$00:0273     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E81 E2 20       SEP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2

$C2:5E83 C6 68       DEC [$00:D+$68]      ;$00:0268     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E85 D0 E6       BNE $5E6D                          A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
//// NEXT
$C2:5E87 AB          PLB                                A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5E88 60          RTS                                A:0000 X:0000 Y:0000 D:0200 DB:7E PB:C2

*** TÄHÄN PÄÄTTYY DIALOGIFONTIN TILENMUODOSTUKSEN APURUTIINI ***

*** TÄSTÄ ALKAA DIALOGIFONTIN TILEN PIKSELIRIVIN APURUTIINI ***

// Rutiini 5E89:
//  PARAMETREJÄ:
//    $0260: (word) tavuoffset fonttibufferipointterin päälle
//    $0262: (byte) merkin järjestysnumero fontissa, alemmat 8 bittiä
//    $026A: (word) pikselipositio rivillä AND 7
//    $0273: (long) pointteri pikselibufferiin tämän hetkisen merkin alkuun
//    $0276: (long) pointteri merkkiin fontissa, part 1
//    $0279: (long) pointteri merkkiin fontissa, part 2
//    $026E: (word) tavuoffset pikselibufferipointterin päälle
//  PAIKALLISIA:
//    $0263: (word) tähän koostetaan bittejä

$C2:5E89 A4 60       LDY [$00:D+$60]      ;$00:0260     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
// Hakee merkin alkuosan ja yhdistää siihen edellisen
$C2:5E8B B7 76       LDA [long[$00:D+$76]+y] ;$FF:36D1  A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E8D EB          XBA                                A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E8E A5 62       LDA [$00:D+$62]      ;$00:0262     A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E90 4A          LSR A                              A:00EF X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E91 90 08       BCC $5E9B                          A:0077 X:0000 Y:0009 D:0200 DB:C2 PB:C2
// Hakee merkin loppuosan ylimmäksi neljäksi bitiksi
$C2:5E93 B7 79       LDA [long[$00:D+$79]+y] ;$FF:4391  A:0077 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E95 0A          ASL A                              A:0040 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E96 0A          ASL A                              A:0080 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E97 0A          ASL A                              A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E98 0A          ASL A                              A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5E99 80 04       BRA $5E9F                          A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
// Hakee merkin loppuosan alemmaksi neljäksi bitiksi
$C2:5E9B B7 79       LDA [long[$00:D+$79]+y] ;$FF:4148
$C2:5E9D 29 F0       AND A, $F0

$C2:5E9F C2 20       REP $20                            A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5EA1 A8          TAY                                A:0000 X:0000 Y:0009 D:0200 DB:C2 PB:C2
$C2:5EA2 64 63       STZ [$00:D+$63]      ;$00:0263     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EA4 A5 6A       LDA [$00:D+$6A]      ;$00:026A     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EA6 29 FF 00    AND A, $00FF                       A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EA9 0A          ASL A                              A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EAA AA          TAX                                A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EAB 98          TYA                                A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EAC 7C AF 5E    JMP [PB:word[PB:$5EAF+x]] ;$C2:5EBF A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C
// Mikä tämä on?
$C2:5EBF E2 20       SEP $20                            A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EC1 A6 6E       LDX [$00:D+$6E]      ;$00:026E     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EC3 BC E8 5F    LDY DB:($5FE8+x)     ;$C2:5FE8     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
// 5FE8 näyttää hakevan luvun (x+2)*8.
// Tämä asettaa näyttömuistiin tavaraa!
//   Pointteri tileen on $0273, ja siellä lukee esim. $7000
$C2:5EC6 97 73       STA [long[$00:D+$73]+y] ;$7E:7018  A:0000 X:0000 Y:0010 D:0200 DB:C2 PB:C2

// Tapaus x=00:
$C2:5EC8 BC E6 5F    LDY DB:($5FE6+x)     ;$C2:5FE6     A:0000 X:0000 Y:0010 D:0200 DB:C2 PB:C2
;; 5FE6 näyttää hakevan luvun x*8.
$C2:5ECB EB          XBA                                A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
// Tämä asettaa näyttömuistiin tavaraa!
$C2:5ECC 97 73       STA [long[$00:D+$73]+y] ;$7E:7008  A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5ECE 60          RTS                                A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2

// Tapaus X=08:
$C2:5ECF 4A          LSR A                              A:0000 X:0008 Y:0000 D:0200 DB:C2 PB:C2
// Tapaus X=06:
$C2:5ED0 4A          LSR A                              A:0000 X:0008 Y:0000 D:0200 DB:C2 PB:C2
// Tapaus X=04:
$C2:5ED1 4A          LSR A                              A:0000 X:0008 Y:0000 D:0200 DB:C2 PB:C2
// Tapaus X=02:
$C2:5ED2 4A          LSR A                              A:0000 X:0008 Y:0000 D:0200 DB:C2 PB:C2
$C2:5ED3 E2 20       SEP $20                            A:0000 X:0008 Y:0000 D:0200 DB:C2 PB:C2
$C2:5ED5 A6 6E       LDX [$00:D+$6E]      ;$00:026E     A:0000 X:0008 Y:0000 D:0200 DB:C2 PB:C2
$C2:5ED7 BC E8 5F    LDY DB:($5FE8+x)     ;$C2:5FEC     A:0000 X:0004 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EDA 97 73       STA [long[$00:D+$73]+y] ;$7E:7038  A:0000 X:0004 Y:0030 D:0200 DB:C2 PB:C2
$C2:5EDC BC E6 5F    LDY DB:($5FE6+x)     ;$C2:5FEA     A:0000 X:0004 Y:0030 D:0200 DB:C2 PB:C2
$C2:5EDF EB          XBA                                A:0000 X:0004 Y:0020 D:0200 DB:C2 PB:C2
$C2:5EE0 17 73       ORA [long[$00:D+$73]+y] ;$7E:7028  A:0000 X:0004 Y:0020 D:0200 DB:C2 PB:C2
$C2:5EE2 97 73       STA [long[$00:D+$73]+y] ;$7E:7028  A:0000 X:0004 Y:0020 D:0200 DB:C2 PB:C2
$C2:5EE4 60          RTS                                A:0000 X:0004 Y:0020 D:0200 DB:C2 PB:C2

// Tapaus X=0A:
$C2:5EE5 0A          ASL A                              A:0000 X:000A Y:0000 D:0200 DB:C2 PB:C2
$C2:5EE6 26 63       ROL [$00:D+$63]      ;$00:0263     A:0000 X:000A Y:0000 D:0200 DB:C2 PB:C2
// Tapaus x=0C:
$C2:5EE8 0A          ASL A                              A:0000 X:000C Y:0000 D:0200 DB:C2 PB:C2
$C2:5EE9 26 63       ROL [$00:D+$63]      ;$00:0263     A:0000 X:000C Y:0000 D:0200 DB:C2 PB:C2
// Tapaus X=0E:
$C2:5EEB 0A          ASL A                              A:0000 X:000C Y:0000 D:0200 DB:C2 PB:C2
$C2:5EEC 26 63       ROL [$00:D+$63]      ;$00:0263     A:0000 X:000C Y:0000 D:0200 DB:C2 PB:C2
$C2:5EEE E2 20       SEP $20                            A:0000 X:000C Y:0000 D:0200 DB:C2 PB:C2
$C2:5EF0 A6 6E       LDX [$00:D+$6E]      ;$00:026E     A:0000 X:000C Y:0000 D:0200 DB:C2 PB:C2
$C2:5EF2 BC EA 5F    LDY DB:($5FEA+x)     ;$C2:5FEA     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5EF5 97 73       STA [long[$00:D+$73]+y] ;$7E:7028  A:0000 X:0000 Y:0020 D:0200 DB:C2 PB:C2
$C2:5EF7 BC E8 5F    LDY DB:($5FE8+x)     ;$C2:5FE8     A:0000 X:0000 Y:0020 D:0200 DB:C2 PB:C2
$C2:5EFA EB          XBA                                A:0000 X:0000 Y:0010 D:0200 DB:C2 PB:C2
$C2:5EFB 97 73       STA [long[$00:D+$73]+y] ;$7E:7018  A:0000 X:0000 Y:0010 D:0200 DB:C2 PB:C2
$C2:5EFD BC E6 5F    LDY DB:($5FE6+x)     ;$C2:5FE6     A:0000 X:0000 Y:0010 D:0200 DB:C2 PB:C2
$C2:5F00 A5 63       LDA [$00:D+$63]      ;$00:0263     A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5F02 17 73       ORA [long[$00:D+$73]+y] ;$7E:7008  A:0000 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5F04 97 73       STA [long[$00:D+$73]+y] ;$7E:7008  A:00E0 X:0000 Y:0000 D:0200 DB:C2 PB:C2
$C2:5F06 60          RTS                                A:00E0 X:0000 Y:0000 D:0200 DB:C2 PB:C2

*** TÄHÄN PÄÄTTYY DIALOGIFONTIN TILEN PIKSELIRIVIN APURUTIINI ***



Tiedot fontista:

   $A0 löytyy osoitteista:
        C2:5E25 (byte)
        C2:58BB (byte)
   Pointteri merkkien leveystauluun (sisältää leveydet tavuille $A0-$FF):
        C2:5E29 (long)
   Pointteri fonttidataan:
        C2:5DD2 (word)
   Pointteri fonttidataan (kakkososa):
        C2:5DE3
    
   Kakkososa sisältää merkeille toisen puolikkaan,
   mutta niin että kaksi peräkkäistä merkkiä jakavat 
   saman puolikkaan.      


ASETEKNIIKAT:

;X on tässä aina 0.
$C2:BDD5 86 7E       STX [$00:D+$7E]      ;$00:007E     A:0000 X:0000 Y:0067 D:0000 DB:7E PB:C2

; Tämä $15C4 tässä on offset tekniikkalista-tauluun.
$C2:BDD7 C2 31       REP $31                            A:0000 X:0000 Y:0067 D:0000 DB:7E PB:C2
$C2:BDD9 A9 C4 15    LDA A, $15C4                       A:0000 X:0000 Y:0067 D:0000 DB:7E PB:C2
; Lisätään käsiteltävän tekniikan numero kaiketi.
$C2:BDDC 6F 16 42 00 ADC $00:$4216        ;$00:4216     A:15C4 X:0000 Y:0067 D:0000 DB:7E PB:C2
$C2:BDE0 A8          TAY                                A:1A31 X:0000 Y:0067 D:0000 DB:7E PB:C2
$C2:BDE1 A6 61       LDX [$00:D+$61]      ;$00:0061     A:1A31 X:0000 Y:1A31 D:0000 DB:7E PB:C2
; $0B on pituus, $CC on tekniikkalistan segmentti.
$C2:BDE3 A9 0B CC    LDA A, $CC0B                       A:1A31 X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:BDE6 20 65 EF    JSR DB:$EF65         ;$7E:EF65     A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
; Ks alla
$C2:BDE9 28          PLP                                A:0BDC X:303A Y:1A3C D:0000 DB:7E PB:C2
$C2:BDEA 60          RTS                                A:0BDC X:303A Y:1A3C D:0000 DB:7E PB:C2


WEAPON HELMET ARMOR ACCESSORY:

; $A3BA on offset
$C2:A39D 69 BA A3    ADC A, $A3BA                       A:0000 X:0002 Y:0001 D:0000 DB:7E PB:C2
$C2:A3A0 A8          TAY                                A:A3BA X:0002 Y:0001 D:0000 DB:7E PB:C2
$C2:A3A1 64 7D       STZ [$00:D+$7D]      ;$00:007D     A:A3BA X:0002 Y:A3BA D:0000 DB:7E PB:C2
$C2:A3A3 A2 86 30    LDX $3086                          A:A3BA X:0002 Y:A3BA D:0000 DB:7E PB:C2
; 0A pituus ja C2 segmentti
$C2:A3A6 A9 0A C2    LDA A, $C20A                       A:A3BA X:3086 Y:A3BA D:0000 DB:7E PB:C2
$C2:A3A9 20 65 EF    JSR DB:$EF65         ;$7E:EF65     A:C20A X:3086 Y:A3BA D:0000 DB:7E PB:C2

ITEMS - EQUIP-RUUDUN VASEN LISTA:

$C2:A583 F0 01       BEQ $A586                          A:0038 X:4FC6 Y:0000 D:0000 DB:7E PB:C2
$C2:A585 C8          INY                                A:0038 X:4FC6 Y:0000 D:0000 DB:7E PB:C2
$C2:A586 C2 30       REP $30                            A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A588 DA          PHX                                A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A589 5A          PHY                                A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A58A 20 9A A5    JSR PB:$A59A         ;$C2:A59A     A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A59A 08          PHP                                A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A59B C2 30       REP $30                            A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A59D A9 00 20    LDA A, $2000                       A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A5A0 85 7D       STA [$00:D+$7D]      ;$00:007D     A:2000 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A5A2 AD C9 04    LDA DB:$04C9         ;$7E:04C9     A:2000 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A5A5 29 FF 00    AND A, $00FF                       A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A5A8 F0 0C       BEQ $A5B6                          A:0038 X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:A5AA 20 E2 F2    JSR DB:$F2E2
; Skipataan eka merkki!
$C2:A5AD 3A          DEC A                              A:CC0B X:4FC6 Y:1183 D:0000 DB:7E PB:C2
$C2:A5AE C8          INY                                A:CC0A X:4FC6 Y:1183 D:0000 DB:7E PB:C2
$C2:A5AF 20 65 EF    JSR DB:$EF65         ;$7E:EF65     A:CC0A X:4FC6 Y:1184 D:0000 DB:7E PB:C2
$C2:A5B2 64 7D       STZ [$00:D+$7D]      ;$00:007D     
$C2:A5B4 28          PLP                                
$C2:A5B5 60          RTS                                


ITEM-HAKUFUNKTIO:

$C2:F2E2 08          PHP                                A:008F X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:F2E3 C2 30       REP $30                            A:008F X:4FC6 Y:0001 D:0000 DB:7E PB:C2
;Jos tämän muuttaa LDA:ksi, se vaikuttaa seuraaviin:
; Equip: oikeanpuoleinen lista (bg#0)
; Equip: vasemmanpuoleinen lista (bg#2)
; Osta/myy -ruudut kaupassa (bg #0)
; Equip kaupassa: oikeanpuoleinen lista (bg#0)
; Equip kaupassa: vasemmanpuoleinen lista (bg#2)
;Se ei vaikuta näihin:
; Item-selain inventaariossa (bg#0)
; Item-selain taistelussa (bg#2)
; "xxx saatu" taistelussa (bg#2, isompi fontti)
;
;Kaikki muut paitsi item-selain taistelussa
;tulkitsevat erikoiskoodeja. Item-selain taistelussa
;vain piirtää suoraan sellaisenaan.
;
; Tämä funktio asettaa arvoja rekistereihin: A Y
; Muut rekisterit, myös liput, pysyvät.
$C2:F2E5 29 FF 00    AND A, $00FF                       A:008F X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:F2E8 0A          ASL A                              A:008F X:4FC6 Y:0001 D:0000 DB:7E PB:C2
$C2:F2E9 A8          TAY                                A:011E X:4FC6 Y:0001 D:0000 DB:7E PB:C2
; Mistä tämä pointteri oikein tulee?
$C2:F2EA B9 00 7D    LDA DB:($7D00+y)     ;$7E:7E1E     A:011E X:4FC6 Y:011E D:0000 DB:7E PB:C2
$C2:F2ED A8          TAY                                A:1183 X:4FC6 Y:011E D:0000 DB:7E PB:C2
; Tämä on joka tapauksessa segmentti ja pituus.
$C2:F2EE A9 0B CC    LDA A, $CC0B                       A:1183 X:4FC6 Y:1183 D:0000 DB:7E PB:C2
$C2:F2F1 28          PLP                                A:CC0B X:4FC6 Y:1183 D:0000 DB:7E PB:C2
; Paluuarvot:
;  Y  = offset
;  Ah = segment
;  Al = length
$C2:F2F2 60          RTS                                A:CC0B X:4FC6 Y:1183 D:0000 DB:7E PB:C2


ITEMS:

; Tähän päädytään tilanteissa:
;  - equip-lista (oikea puoli)
;  - kauppa - HUOM: Tulostaa KOODEJA (hinnat, oikea sarake)
;  - equip-lista kaupassa (oikea puoli)
; Tätä ei käytä:
;  - equip-lista (vasen puoli)
;  - equip-lista kaupassa (vasen puoli)
;  - items-selain inventaariossa
; A:ssa on itemin numero
; 
$C2:F2DC 20 E2 F2    JSR DB:$F2E2         ;$7E:F2E2     A:0005 X:2F5C Y:000A D:0000 DB:7E PB:C2
;Ks yllä
$C2:F2DF 4C 65 EF    JMP DB:$EF65         ;$7E:EF65     A:CC0B X:2F5C Y:0B95 D:0000 DB:7E PB:C2

ITEMS-SELAIN INVENTAARIOSSA:

$C2:AE75 7B          TDC                                A:0038 X:344A Y:0038 D:0000 DB:7E PB:C2
$C2:AE76 B9 00 25    LDA DB:($2500+y)     ;$7E:2538     A:0000 X:344A Y:0038 D:0000 DB:7E PB:C2
$C2:AE79 8D 4E 0D    STA DB:$0D4E         ;$7E:0D4E     A:0001 X:344A Y:0038 D:0000 DB:7E PB:C2
$C2:AE7C B9 00 24    LDA DB:($2400+y)     ;$7E:2438     A:0001 X:344A Y:0038 D:0000 DB:7E PB:C2
$C2:AE7F 8D 4D 0D    STA DB:$0D4D         ;$7E:0D4D     A:008B X:344A Y:0038 D:0000 DB:7E PB:C2
$C2:AE82 A8          TAY                                A:008B X:344A Y:0038 D:0000 DB:7E PB:C2
$C2:AE83 B9 00 77    LDA DB:($7700+y)     ;$7E:778B     A:008B X:344A Y:008B D:0000 DB:7E PB:C2
$C2:AE86 29 02       AND A, $02                         A:0014 X:344A Y:008B D:0000 DB:7E PB:C2
$C2:AE88 F0 04       BEQ $AE8E                          A:0000 X:344A Y:008B D:0000 DB:7E PB:C2
$C2:AE8E 4C 4B B0    JMP DB:$B04B         ;$7E:B04B     A:0000 X:344A Y:008B D:0000 DB:7E PB:C2
$C2:B04B 08          PHP                                A:0000 X:344A Y:008B D:0000 DB:7E PB:C2
$C2:B04C E2 20       SEP $20                            A:0000 X:344A Y:008B D:0000 DB:7E PB:C2
$C2:B04E AD 4D 0D    LDA DB:$0D4D         ;$7E:0D4D     A:0000 X:344A Y:008B D:0000 DB:7E PB:C2
$C2:B051 F0 4C       BEQ $B09F                          A:008B X:344A Y:008B D:0000 DB:7E PB:C2

$C2:B053 C2 20       REP $20                            A:008B X:344A Y:008B D:0000 DB:7E PB:C2
;A on nyt itemin numero.
$C2:B055 29 FF 00    AND A, $00FF                       A:008B X:344A Y:008B D:0000 DB:7E PB:C2
$C2:B058 0A          ASL A                              A:008B X:344A Y:008B D:0000 DB:7E PB:C2
$C2:B059 A8          TAY                                A:0116 X:344A Y:008B D:0000 DB:7E PB:C2
;Hakee pointterin itemin nimeen.
$C2:B05A B9 00 7D    LDA DB:($7D00+y)     ;$7E:7E16     A:0116 X:344A Y:0116 D:0000 DB:7E PB:C2
$C2:B05D A8          TAY                                A:1157 X:344A Y:0116 D:0000 DB:7E PB:C2
$C2:B05E A9 0B CC    LDA A, $CC0B                       A:1157 X:344A Y:1157 D:0000 DB:7E PB:C2

$C2:B061 20 65 EF    JSR PB:$EF65         ;$C2:EF65     A:CC0B X:344A Y:1157 D:0000 DB:7E PB:C2
;Kutsuu piirtorutiinia itemille.
$C2:B064 A5 7D       LDA [$00:D+$7D]      ;$00:007D     A:0BDC X:3460 Y:1162 D:0000 DB:7E PB:C2
;Hakee attribuutin^
$C2:B066 29 00 FF    AND A, $FF00                       A:0000 X:3460 Y:1162 D:0000 DB:7E PB:C2
$C2:B069 09 2D 00    ORA A, $002D                       A:0000 X:3460 Y:1162 D:0000 DB:7E PB:C2
;Lisää siihen kaksoispisteen^
$C2:B06C 9D 00 00    STA DB:($0000+x)     ;$7E:3460     A:002D X:3460 Y:1162 D:0000 DB:7E PB:C2
;Ja piirtää sen.^
$C2:B06F E8          INX                                A:002D X:3460 Y:1162 D:0000 DB:7E PB:C2
$C2:B070 E8          INX                                A:002D X:3461 Y:1162 D:0000 DB:7E PB:C2
$C2:B071 A0 4E 0D    LDY $0D4E                          A:002D X:3462 Y:1162 D:0000 DB:7E PB:C2
$C2:B074 A9 11 7E    LDA A, $7E11                       A:002D X:3462 Y:0D4E D:0000 DB:7E PB:C2
$C2:B077 20 14 F1    JSR PB:$F114         ;$C2:F114     A:7E11 X:3462 Y:0D4E D:0000 DB:7E PB:C2
;Kutsuu ???
$C2:B07A E8          INX                                A:0000 X:3466 Y:0D4F D:0000 DB:7E PB:C2
$C2:B07B E8          INX                                A:0000 X:3467 Y:0D4F D:0000 DB:7E PB:C2
$C2:B07C DA          PHX                                A:0000 X:3468 Y:0D4F D:0000 DB:7E PB:C2
$C2:B07D 9E 00 00    STZ DB:($0000+x)     ;$7E:3468     A:0000 X:3468 Y:0D4F D:0000 DB:7E PB:C2
$C2:B080 9B          TXY                                A:0000 X:3468 Y:0D4F D:0000 DB:7E PB:C2
$C2:B081 C8          INY                                A:0000 X:3468 Y:3468 D:0000 DB:7E PB:C2
$C2:B082 C8          INY                                A:0000 X:3468 Y:3469 D:0000 DB:7E PB:C2
$C2:B083 A9 0F 00    LDA A, $000F                       A:0000 X:3468 Y:346A D:0000 DB:7E PB:C2
$C2:B086 54          MVN 7E 7E                          A:000F X:3468 Y:346A D:0000 DB:7E PB:C2
$C2:B089 AD 4D 0D    LDA DB:$0D4D         ;$7E:0D4D     A:FFFF X:3478 Y:347A D:0000 DB:7E PB:C2
$C2:B08C 29 FF 00    AND A, $00FF                       A:018B X:3478 Y:347A D:0000 DB:7E PB:C2
$C2:B08F 0A          ASL A                              A:008B X:3478 Y:347A D:0000 DB:7E PB:C2
$C2:B090 AA          TAX                                A:0116 X:3478 Y:347A D:0000 DB:7E PB:C2
$C2:B091 BF 10 B3 FF LDA $FF:($B310+x)    ;$FF:B426     A:0116 X:0116 Y:347A D:0000 DB:7E PB:C2
$C2:B095 A8          TAY                                A:C5ED X:0116 Y:347A D:0000 DB:7E PB:C2
$C2:B096 FA          PLX                                A:C5ED X:0116 Y:C5ED D:0000 DB:7E PB:C2
$C2:B097 A9 09 FF    LDA A, $FF09                       A:C5ED X:3468 Y:C5ED D:0000 DB:7E PB:C2
$C2:B09A 20 65 EF    JSR PB:$EF65         ;$C2:EF65     A:FF09 X:3468 Y:C5ED D:0000 DB:7E PB:C2
;Kutsuu piirtorutiinia UUDESTAAN
$C2:B09D 28          PLP                                A:09DC X:3474 Y:C5F3 D:0000 DB:7E PB:C2
$C2:B09E 60          RTS                                A:09DC X:3474 Y:C5F3 D:0000 DB:7E PB:C2
$C2:AE73 28          PLP                                A:09DC X:3474 Y:C5F3 D:0000 DB:7E PB:C2
$C2:AE74 60          RTS                                A:09DC X:3474 Y:C5F3 D:0000 DB:7E PB:C2

TECHNIQUE STATUS-RUUDULLA:

// Rutiinin alku:
$C2:BD99 08          PHP                                A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
$C2:BD9A E2 20       SEP $20                            A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
$C2:BD9C AD 4C 0F    LDA DB:$0F4C         ;$7E:0F4C     A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
// Haki tekniikan numeron?
$C2:BD9F 30 05       BMI $BDA6                          A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
$C2:BDA1 20 B2 BD    JSR PB:$BDB2         ;$C2:BDB2     A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
// Tulostetaan.
$C2:BDA4 28          PLP                                A:0BDC X:303A Y:16E2 D:0000 DB:7E PB:C2 
$C2:BDA5 60          RTS                                A:0BDC X:303A Y:16E2 D:0000 DB:7E PB:C2 

TEKNIIKAN TULOSTUS, VÄRIT JA KAIKKI:
// Rutiinin alku.
$C2:BDB2 08          PHP                                A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
$C2:BDB3 E2 30       SEP $30                            A:0019 X:3024 Y:0000 D:0000 DB:7E PB:C2 
// Tekniikan numero KERTOLASKUREKISTERIIN
$C2:BDB5 8F 02 42 00 STA $00:$4202        ;$00:4202     A:0019 X:0024 Y:0000 D:0000 DB:7E PB:C2 
$C2:BDB9 A8          TAY                                A:0019 X:0024 Y:0000 D:0000 DB:7E PB:C2 
// Taulun koko (11) KERTOLASKUREKISTERIIN
$C2:BDBA A9 0B       LDA A, $0B                         A:0019 X:0024 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDBC 8F 03 42 00 STA $00:$4203        ;$00:4203     A:000B X:0024 Y:0019 D:0000 DB:7E PB:C2 
// Jotain touhua
$C2:BDC0 A2 0C       LDX $0C                            A:000B X:0024 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDC2 B9 00 77    LDA DB:($7700+y)     ;$7E:7719     A:000B X:000C Y:0019 D:0000 DB:7E PB:C2 
$C2:BDC5 89 40       BIT A, $40                         A:0000 X:000C Y:0019 D:0000 DB:7E PB:C2 
$C2:BDC7 D0 0C       BNE $BDD5                          A:0000 X:000C Y:0019 D:0000 DB:7E PB:C2 
$C2:BDC9 A2 00       LDX $00                            A:0000 X:000C Y:0019 D:0000 DB:7E PB:C2 
$C2:BDCB 89 80       BIT A, $80                         A:0000 X:0000 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDCD F0 06       BEQ $BDD5                          A:0000 X:0000 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDD5 86 7E       STX [$00:D+$7E]      ;$00:007E     A:0000 X:0000 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDD7 C2 31       REP $31                            A:0000 X:0000 Y:0019 D:0000 DB:7E PB:C2 
// Pointteri tekniikkatauluun
$C2:BDD9 A9 C4 15    LDA A, $15C4                       A:0000 X:0000 Y:0019 D:0000 DB:7E PB:C2 
// Haetaan tulos KERTOLASKUREKISTERISTÄ
$C2:BDDC 6F 16 42 00 ADC $00:$4216        ;$00:4216     A:15C4 X:0000 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDE0 A8          TAY                                A:16D7 X:0000 Y:0019 D:0000 DB:7E PB:C2 
$C2:BDE1 A6 61       LDX [$00:D+$61]      ;$00:0061     A:16D7 X:0000 Y:16D7 D:0000 DB:7E PB:C2 
$C2:BDE3 A9 0B CC    LDA A, $CC0B                       A:16D7 X:3024 Y:16D7 D:0000 DB:7E PB:C2 
// Kutsutaan vanhaa tuttua rutiinia!
$C2:BDE6 20 65 EF    JSR PB:$EF65         ;$C2:EF65     A:CC0B X:3024 Y:16D7 D:0000 DB:7E PB:C2 
// Ja pois.
$C2:BDE9 28          PLP                                A:0BDC X:303A Y:16E2 D:0000 DB:7E PB:C2 
$C2:BDEA 60          RTS                                A:0BDC X:303A Y:16E2 D:0000 DB:7E PB:C2 



; Tämä lienee geneerinen tekstintulostusrutiini 8x8-fontille.
; Tätä käyttää:
; - kaikki item-ruudut, paitsi ks alla
; Tätä *ei* käytä:
; - item-selain taistelussa
;
; Sisään tullessa:
;    Ah:Y = osoite tekstidataan
;    Al   = pituus
;    DB:X = kohde (?)

//  PARAMETREJÄ:
//    $007E: (byte) ???
//  PAIKALLISIA:
//    $0088: (byte) merkkijonon pituus
//    $0087: (byte) merkkijonon pituus & 127
//    $0065: (word) kohde (?)

$C2:EF65 8B          PHB                                A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF66 08          PHP                                A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF67 E2 20       SEP $20                            A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
; Pituus talteen
$C2:EF69 85 88       STA [$00:D+$88]      ;$00:0088     A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
; Pituus & 127  talteen myös.. (?)
$C2:EF6B 29 7F       AND A, $7F                         A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF6D 85 87       STA [$00:D+$87]      ;$00:0087     A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF6F 86 65       STX [$00:D+$65]      ;$00:0065     A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF71 EB          XBA                                A:CC0B X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF72 48          PHA                                A:0BCC X:3024 Y:1A31 D:0000 DB:7E PB:C2
$C2:EF73 AB          PLB                                A:0BCC X:3024 Y:1A31 D:0000 DB:7E PB:C2
;Segmentti DB-rekisteriksi.
;Käydään tulostamassa merkkijono.
$C2:EF74 20 7E EF    JSR DB:$EF7E         ;$CC:EF7E     A:0BCC X:3024 Y:1A31 D:0000 DB:CC PB:C2
;Ks alla
$C2:EF77 A9 DC       LDA A, $DC                         A:0B00 X:303A Y:1A3C D:0000 DB:CC PB:C2
$C2:EF79 14 7E       TRB [$00:D+$7E]      ;$00:007E     A:0BDC X:303A Y:1A3C D:0000 DB:CC PB:C2
$C2:EF7B 28          PLP                                A:0BDC X:303A Y:1A3C D:0000 DB:CC PB:C2
$C2:EF7C AB          PLB                                A:0BDC X:303A Y:1A3C D:0000 DB:CC PB:C2
$C2:EF7D 60          RTS                                A:0BDC X:303A Y:1A3C D:0000 DB:7E PB:C2

;Käsittelee yhden merkin kerrallaan 8x8-komentosarjasta.
;  Toiminta:
;      -haetaan merkki [DB:$0000+y]
;      -jos 0, loppu
;      -jos <16, kontrollimerkin käsittely ($C2:EFBE)
;      -piirto ($C2:EF97)
;      -laskurin $0287 pienennys; jos > 0, uusiksi tämä
;      -loppu

$C2:EF7E E2 20       SEP $20                            A:0BCC X:3024 Y:1A31 D:0000 DB:CC PB:C2
$C2:EF80 B9 00 00    LDA DB:($0000+y)     ;$CC:1A31     A:0BCC X:3024 Y:1A31 D:0000 DB:CC PB:C2
$C2:EF83 F0 11       BEQ $EF96                          A:0BAB X:3024 Y:1A31 D:0000 DB:CC PB:C2
$C2:EF85 C8          INY                                A:0BAB X:3024 Y:1A31 D:0000 DB:CC PB:C2
$C2:EF86 C9 10       CMP A, $10                         A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF88 B0 05       BCS $EF8F                          A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF8A 20 BE EF    JSR DB:$EFBE         ;$FF:EFBE     A:0005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:EF8F 20 97 EF    JSR DB:$EF97         ;$CC:EF97     A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF92 C6 87       DEC [$00:D+$87]      ;$00:0087     A:0B00 X:3026 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF94 D0 E8       BNE $EF7E                          A:0B00 X:3026 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF96 60          RTS                                A:0B00 X:303A Y:1A3C D:0000 DB:CC PB:C2

;YHDEN 8x8-MERKIN *PIIRTO*
$C2:EF97 08          PHP                                A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF98 E2 20       SEP $20                            A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF9A 24 88       BIT [$00:D+$88]      ;$00:0088     A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF9C 30 12       BMI $EFB0                          A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EF9E C9 FF       CMP A, $FF                         A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EFA0 D0 0E       BNE $EFB0                          A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2

;Merkki oli $FF. Asetetaan tyhjä ja väri... jonnekin?
$C2:EFA2 EB          XBA                                A:00FF X:32A8 Y:0002 D:0000 DB:FF PB:C2
$C2:EFA3 A9 FF       LDA A, $FF                         A:FF00 X:32A8 Y:0002 D:0000 DB:FF PB:C2
$C2:EFA5 9F C0 FF 7D STA $7D:($FFC0+x)    ;$7D:3268     A:FFFF X:32A8 Y:0002 D:0000 DB:FF PB:C2
$C2:EFA9 A5 7E       LDA [$00:D+$7E]      ;$00:007E     A:FFFF X:32A8 Y:0002 D:0000 DB:FF PB:C2
$C2:EFAB 9F C1 FF 7D STA $7D:($FFC1+x)    ;$7D:3269     A:FF00 X:32A8 Y:0002 D:0000 DB:FF PB:C2
$C2:EFAF EB          XBA                                A:FF00 X:32A8 Y:0002 D:0000 DB:FF PB:C2

;Asetetaan merkki ja väri .. jonnekin?
$C2:EFB0 9F 00 00 7E STA $7E:($0000+x)    ;$7E:3024     A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
; Tämä on joku attribuuttitavu.
;   $80: Yflip
;   $40: Xflip
;   $20: priority changes
;   $10: palette changes
;   $08: palette changes
;   $04: palette changes
;   $02, $01: character changes
$C2:EFB4 A5 7E       LDA [$00:D+$7E]      ;$00:007E     A:0BAB X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EFB6 9F 01 00 7E STA $7E:($0001+x)    ;$7E:3025     A:0B00 X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EFBA E8          INX                                A:0B00 X:3024 Y:1A32 D:0000 DB:CC PB:C2
$C2:EFBB E8          INX                                A:0B00 X:3025 Y:1A32 D:0000 DB:CC PB:C2
$C2:EFBC 28          PLP                                A:0B00 X:3026 Y:1A32 D:0000 DB:CC PB:C2
$C2:EFBD 60          RTS                                A:0B00 X:3026 Y:1A32 D:0000 DB:CC PB:C2

;8x8-OHJAUSKOODIEN KÄSITTELIJÄ
;Käsittelee merkit <$10.
$C2:EFBE DA          PHX                                A:0005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:EFBF C2 20       REP $20                            A:0005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:EFC1 29 FF 00    AND A, $00FF                       A:0005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:EFC4 0A          ASL A                              A:0005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:EFC5 AA          TAX                                A:000A X:2ECA Y:C82C D:0000 DB:FF PB:C2
; EFD4: hyppyosoitetaulu
$C2:EFC6 BF D4 EF C2 LDA $C2:($EFD4+x)    ;$C2:EFDE     A:000A X:000A Y:C82C D:0000 DB:FF PB:C2
$C2:EFCA 85 8A       STA [$00:D+$8A]      ;$00:008A     A:F036 X:000A Y:C82C D:0000 DB:FF PB:C2
$C2:EFCC FA          PLX                                A:F036 X:000A Y:C82C D:0000 DB:FF PB:C2
;Käytännössä CALL
$C2:EFCD 62 02 00    PER $EFD2                          A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:EFD0 6C 8A 00    JMP [PB:word[$008A]] ;$C2:F036     A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2

; Taulun C2:EFD4 sisältö:
;  0-7: EFD3 EFF4 F005 F011  F022 F036 F0A2 F071
;  8-F: F08D F0B8 F068 F0C1  F0D1 EFD3 EFD3 EFD3
;
;  * EFD3: #0-käsittelijä - pelkkä RTS
;  * EFF4: (next)#1-käsittelijä - X = [$0265] + [$0287&0x80] ? 0x80 : 0x40
;  * F005: (goto)#2-käsittelijä - X = [$0265] = syöty 16-bit + [$0261]
;    F011: (func1)#3-käsittelijä - call $F114 with syöty 16-bit=Y, syöty 16-bit=A
;  * F022: (substr)#4-käsittelijä - syöty 24-bit -> pointteri, piirretään substring
;  * F036: (member)#5-käsittelijä - $7E:syöty 16-bit -> tulostettava hahmonimi, fill length 5
;  * F0A2: (attrs)#6-käsittelijä - [$7E:syöty 16-bit] -> 8-bit arvo josta $1C bitit -> [$027E]
;  * F071: (out)#7-käsittelijä - [$7E:syöty 16-bit] -> 16-bit merkki, tulostetaan
;  * F08D: (spc)#8-käsittelijä - syöty 8-bit * tulostaa 255
;  * F0B8: (len)#9-käsittelijä - [$0288] = syöty 8-bit
;  * F068: (attr)#A-käsittelijä - [$027E] = syöty 8-bit
;  * F0C1: (func2)#B-käsittelijä - call $F227 with syöty 16-bit=Y, syöty 16-bit=A
;  * F0D1: (stat)#C-käsittelijä - syöty 8-bit=idx, [$7E:syöty 16-bit]=arvo, tulostaa statin.


$C2:EFD3 60          RTS                                A:8000 X:2ED4 Y:C82E D:0000 DB:FF PB:C2

; Käsittelee merkin $01.
;  Toiminta;
;    - Jos $0287:ssä on 7. bitti päällä,
;      lisää $0265-muuttujaan $0040.
;      Muutoin $0080.
;      Tulos X:ään.
;      MIKSI?
$C2:EFF4 A9 80 00    LDA A, $0080        
$C2:EFF7 24 87       BIT [$00:D+$87]      ;$00:0087
$C2:EFF9 10 03       BPL $EFFE                     
$C2:EFFB A9 40 00    LDA A, $0040                  
$C2:EFFE 18          CLC                           
$C2:EFFF 65 65       ADC [$00:D+$65]      ;$00:0065
$C2:F001 85 65       STA [$00:D+$65]      ;$00:0065
$C2:F003 AA          TAX                           
$C2:F004 60          RTS                           

; Käsittelee merkin $02.
;  Toiminta:
;    Syö 16-bittisen luvun, lisää muuttujan $0261 ja tallettaa $0265.
;    Tulos X:ään.
$C2:F005 B9 00 00    LDA DB:($0000+y)     ;$00:0038
$C2:F008 18          CLC                           
$C2:F009 65 61       ADC [$00:D+$61]      ;$00:0061
$C2:F00B 85 65       STA [$00:D+$65]      ;$00:0065
$C2:F00D AA          TAX                           
$C2:F00E C8          INY                           
$C2:F00F C8          INY                           
$C2:F010 60          RTS                           

; Käsittelee merkin $03.
;   Toiminta:
;     Syö kaksi 16-bittistä lukua.
;     Ekan antaa Y:nä ja tokan A:na rutiinille $F114.
$C2:F011 5A          PHY                           
$C2:F012 B9 00 00    LDA DB:($0000+y)     ;$00:0038
$C2:F015 48          PHA                           
$C2:F016 B9 02 00    LDA DB:($0002+y)     ;$00:003A
$C2:F019 7A          PLY                           
$C2:F01A 20 14 F1    JSR PB:$F114         ;$7E:F114
$C2:F01D 7A          PLY                           
$C2:F01E C8          INY                           
$C2:F01F C8          INY                           
;yhteinen loppu $02:n kanssa.
$C2:F020 80 EC       BRA $F00E                     

; Käsittelee merkin $04.
;   Toiminta:
;     Syö 24-bittisen pointterin (long).
;     Asettaa sen DB:Y:ksi ja kutsuu rekursiivisesti $EF7E.
$C2:F022 5A          PHY                           
$C2:F023 8B          PHB                           
$C2:F024 B9 01 00    LDA DB:($0001+y)     ;$00:0039
$C2:F027 48          PHA                           
$C2:F028 B9 00 00    LDA DB:($0000+y)     ;$00:0038
$C2:F02B A8          TAY                           
$C2:F02C AB          PLB                           
$C2:F02D AB          PLB                           
$C2:F02E 20 7E EF    JSR PB:$EF7E         ;$7E:EF7E
$C2:F031 AB          PLB                           
$C2:F032 7A          PLY                           
$C2:F033 C8          INY                           
;yhteinen loppu $02:n kanssa.
$C2:F034 80 D8       BRA $F00E                     

; Käsittelee merkin $05 ([ptr xxxx])
;  Toiminta:
;      - [$0287] talteen homman ajaksi
;      - [$0287] <- $8005
;      - tulostaa hahmonimen [$7E:syöty 16-bit]
;      - täyttää 255:llä viiden merkin pituuteen.
;
$C2:F036 D4 87       PEI [$00:D+$87]                    A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F038 5A          PHY                                A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F039 8B          PHB                                A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F03A 08          PHP                                A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F03B 8A          TXA                                A:F036 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F03C 18          CLC                                A:2ECA X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F03D 69 0A 00    ADC A, $000A                       A:2ECA X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F040 48          PHA                                A:2ED4 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F041 A9 05 80    LDA A, $8005                       A:2ED4 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F044 85 87       STA [$00:D+$87]      ;$00:0087     A:8005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F046 B9 00 00    LDA DB:($0000+y)     ;$FF:C82C     A:8005 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F049 A8          TAY                                A:9AE0 X:2ECA Y:C82C D:0000 DB:FF PB:C2
$C2:F04A F4 7E 7E    PEA DB:$7E7E         ;$FF:7E7E     A:9AE0 X:2ECA Y:9AE0 D:0000 DB:FF PB:C2
$C2:F04D AB          PLB                                A:9AE0 X:2ECA Y:9AE0 D:0000 DB:FF PB:C2
$C2:F04E AB          PLB                                A:9AE0 X:2ECA Y:9AE0 D:0000 DB:7E PB:C2
$C2:F04F 20 7E EF    JSR DB:$EF7E         ;$7E:EF7E     A:9AE0 X:2ECA Y:9AE0 D:0000 DB:7E PB:C2
;Huh, rekursio?
$C2:F052 A5 87       LDA [$00:D+$87]      ;$00:0087     A:9A00 X:2ED2 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F054 F0 09       BEQ $F05F                          A:9A01 X:2ED2 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F056 A9 FF       LDA A, $FF                         A:9A01 X:2ED2 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F058 20 97 EF    JSR DB:$EF97         ;$7E:EF97     A:9AFF X:2ED2 Y:9AE4 D:0000 DB:7E PB:C2
;Ks yllä
$C2:F05B C6 87       DEC [$00:D+$87]      ;$00:0087     A:9A00 X:2ED4 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F05D D0 F7       BNE $F056                          A:9A00 X:2ED4 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F05F FA          PLX                                A:9A00 X:2ED4 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F060 28          PLP                                A:9A00 X:2ED4 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F061 AB          PLB                                A:9A00 X:2ED4 Y:9AE4 D:0000 DB:7E PB:C2
$C2:F062 7A          PLY                                A:9A00 X:2ED4 Y:9AE4 D:0000 DB:FF PB:C2
$C2:F063 68          PLA                                A:9A00 X:2ED4 Y:C82C D:0000 DB:FF PB:C2
$C2:F064 85 87       STA [$00:D+$87]      ;$00:0087     A:8000 X:2ED4 Y:C82C D:0000 DB:FF PB:C2
$C2:F066 80 A6       BRA $F00E                          A:8000 X:2ED4 Y:C82C D:0000 DB:FF PB:C2
$C2:F00E C8          INY                                A:8000 X:2ED4 Y:C82C D:0000 DB:FF PB:C2
$C2:F00F C8          INY                                A:8000 X:2ED4 Y:C82D D:0000 DB:FF PB:C2
$C2:F010 60          RTS                                A:8000 X:2ED4 Y:C82E D:0000 DB:FF PB:C2


; Käsittelee merkin $06.
;   Toiminta:
;     Syö 16-bittisen luvun X:ksi.
;     Hakee osoitetusta paikasta 8-bittisen luvun
;     Asettaa muuttujan $027E bitit $1C sieltä.
$C2:F0A2 E2 20       SEP $20                            A:F0A2 X:32A8 Y:C7EE D:0000 DB:FF PB:C2
$C2:F0A4 DA          PHX                                A:F0A2 X:32A8 Y:C7EE D:0000 DB:FF PB:C2
$C2:F0A5 BE 00 00    LDX DB:($0000+y)     ;$FF:C7EE     A:F0A2 X:32A8 Y:C7EE D:0000 DB:FF PB:C2
$C2:F0A8 C8          INY                                A:F0A2 X:0D5D Y:C7EE D:0000 DB:FF PB:C2
$C2:F0A9 C8          INY                                A:F0A2 X:0D5D Y:C7EF D:0000 DB:FF PB:C2
$C2:F0AA A9 1C       LDA A, $1C                         A:F0A2 X:0D5D Y:C7F0 D:0000 DB:FF PB:C2
$C2:F0AC 14 7E       TRB [$00:D+$7E]      ;$00:007E     A:F01C X:0D5D Y:C7F0 D:0000 DB:FF PB:C2
$C2:F0AE BF 00 00 7E LDA $7E:($0000+x)    ;$7E:0D5D     A:F01C X:0D5D Y:C7F0 D:0000 DB:FF PB:C2
$C2:F0B2 29 1C       AND A, $1C                         A:F000 X:0D5D Y:C7F0 D:0000 DB:FF PB:C2
$C2:F0B4 04 7E       TSB [$00:D+$7E]      ;$00:007E     A:F000 X:0D5D Y:C7F0 D:0000 DB:FF PB:C2
$C2:F0B6 FA          PLX                                A:F000 X:0D5D Y:C7F0 D:0000 DB:FF PB:C2
$C2:F0B7 60          RTS                                A:F000 X:32A8 Y:C7F0 D:0000 DB:FF PB:C2

; Käsittelee merkin $07.
;   Toiminta:
;     Syö 16-bittisen luvun Y:ksi.
;     Hakee 16-bittisen luvun osoittesta $7E:Y.
;     Piirtää sen.
$C2:F071 5A          PHY                              
$C2:F072 8B          PHB                              
$C2:F073 B9 00 00    LDA DB:($0000+y)     ;$00:0038   
$C2:F076 A8          TAY                              
$C2:F077 F4 7E 7E    PEA DB:$7E7E         ;$00:7E7E   
$C2:F07A AB          PLB                              
$C2:F07B AB          PLB                              
$C2:F07C B9 00 00    LDA DB:($0000+y)     ;$00:0038   
$C2:F07F 9D 00 00    STA DB:($0000+x)     ;$00:08B3   
$C2:F082 AB          PLB                              
$C2:F083 7A          PLY                              
$C2:F084 E2 20       SEP $20                          
$C2:F086 E8          INX                              
$C2:F087 E8          INX                              
$C2:F088 C6 87       DEC [$00:D+$87]      ;$00:0087   
;yhteinen loppu $02:n kanssa.
$C2:F08A 4C 0E F0    JMP DB:$F00E         ;$00:F00E   

; Käsittelee merkin $08.
;   Toiminta:
;     Syö 8-bittisen luvun määräksi.
;     Piirtää sen kpl kertaa merkkiä 255.
$C2:F08D B9 00 00    LDA DB:($0000+y)     ;$00:0038   
$C2:F090 C8          INY                              
$C2:F091 5A          PHY                              
$C2:F092 29 FF 00    AND A, $00FF                     
$C2:F095 A8          TAY                              
$C2:F096 E2 20       SEP $20                          
$C2:F098 A9 FF       LDA A, $FF                     
$C2:F09A 20 97 EF    JSR PB:$EF97         ;$C3:EF97
$C2:F09D 88          DEY                              
$C2:F09E D0 F8       BNE $F098                        
$C2:F0A0 7A          PLY                              
$C2:F0A1 60          RTS                              

; Käsittelee merkin $09.
;   Toiminta:
;     Syö 8-bittisen luvun.
;     Sijoittaa sen $0288 -muuttujaan.
$C2:F0B8 E2 20       SEP $20                         
$C2:F0BA B9 00 00    LDA DB:($0000+y)     ;$FE:040A  
$C2:F0BD 85 88       STA [$00:D+$88]      ;$00:0388  
$C2:F0BF C8          INY                             
$C2:F0C0 60          RTS                             

; Käsittelee merkin $0A.
;   Toiminta:
;     Syö 8-bittisen luvun.
;     Sijoittaa sen $027E -muuttujaan.
$C2:F068 E2 20       SEP $20                         
$C2:F06A B9 00 00    LDA DB:($0000+y)     ;$FE:040A  
$C2:F06D 85 7E       STA [$00:D+$7E]      ;$00:037E  
$C2:F06F C8          INY                             
$C2:F070 60          RTS                             

; Käsittelee merkin $0B.
;   Toiminta:
;     Syö kaksi 16-bittistä lukua.
;     Ekan antaa Y:nä ja tokan A:na rutiinille $F227.
$C2:F0C1 5A          PHY                             
$C2:F0C2 B9 00 00    LDA DB:($0000+y)     ;$00:0038  
$C2:F0C5 48          PHA                             
$C2:F0C6 B9 02 00    LDA DB:($0002+y)     ;$00:003A  
$C2:F0C9 7A          PLY                             
$C2:F0CA 20 27 F2    JSR PB:$F227         ;$7E:F227  
$C2:F0CD 7A          PLY                             
;yhteinen loppu $03:n kanssa.
$C2:F0CE 4C 1E F0    JMP DB:$F01E         ;$00:F01E  

; Käsittelee merkin $0C.
;   Toiminta:
;     Syö 8-bittisen luvun.
;     Syö 16-bittisen offsetin.
;     Hakee osoitteesta [$7E:offset] 8-bittisen luvun.
;     Vertaa sitä [$FF:CF33 + eka luku].
;     Jos arvo on pienempi,
;       kutsuu $F114-funktiota A=$7E11
;     muutoin
;       hakee attr [$027E] ja sijoittaa kaksi tähteä
;       X:n osoittamaan kohtaan.
$C2:F0D1 8B          PHB                           
$C2:F0D2 5A          PHY                           
$C2:F0D3 DA          PHX                           
$C2:F0D4 B9 00 00    LDA DB:($0000+y)     ;$00:0038
$C2:F0D7 29 FF 00    AND A, $00FF                  
$C2:F0DA AA          TAX                           
$C2:F0DB B9 01 00    LDA DB:($0001+y)     ;$00:0039
$C2:F0DE A8          TAY                           
$C2:F0DF E2 20       SEP $20                       
$C2:F0E1 F4 7E 7E    PEA DB:$7E7E         ;$00:7E7E
$C2:F0E4 AB          PLB                           
$C2:F0E5 AB          PLB                           
$C2:F0E6 B9 00 00    LDA DB:($0000+y)     ;$00:0038
$C2:F0E9 DF 33 CF FF CMP $FF:($CF33+x)    ;$FF:D7E6
$C2:F0ED FA          PLX                           
$C2:F0EE B0 0A       BCS $F0FA                     
;if
$C2:F0F0 A9 7E       LDA A, $7E                  
$C2:F0F2 EB          XBA
$C2:F0F3 A9 11       LDA A, $11                  
$C2:F0F5 20 14 F1    JSR PB:$F114         ;$7E:F114 
$C2:F0F8 80 14       BRA $F10E                     
;else - muodostetaan tähti
$C2:F0FA A9 2F       LDA A, $2F                  
$C2:F0FC 9D 00 00    STA DB:($0000+x)     ;$00:08B3   
$C2:F0FF 9D 02 00    STA DB:($0002+x)     ;$00:08B5
$C2:F102 A5 7E       LDA [$00:D+$7E]      ;$00:007E
$C2:F104 9D 01 00    STA DB:($0001+x)     ;$00:08B4
$C2:F107 9D 03 00    STA DB:($0003+x)     ;$00:08B6
$C2:F10A E8          INX                           
$C2:F10B E8          INX                           
$C2:F10C E8          INX                           
$C2:F10D E8          INX                           
;endif
$C2:F10E 7A          PLY                           
$C2:F10F AB          PLB                           
$C2:F110 C8          INY                           
$C2:F111 C8          INY                           
$C2:F112 C8          INY                           
$C2:F113 60          RTS                           

; Missä tämä on?
$C1:09C1 85 84       STA [$00:D+$84]      ;$00:0084     A:00C0 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09C3 0A          ASL A                              A:00C0 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09C4 0A          ASL A                              A:0180 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09C5 85 8E       STA [$00:D+$8E]      ;$00:008E     A:0300 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09C7 0A          ASL A                              A:0300 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09C8 18          CLC                                A:0600 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09C9 65 8E       ADC [$00:D+$8E]      ;$00:008E     A:0600 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09CB 38          SEC                                A:0900 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09CC E5 84       SBC [$00:D+$84]      ;$00:0084     A:0900 X:000F Y:0180 D:0000 DB:7E PB:C1
;0B5E = item-taulun osoite
$C1:09CE 69 5E 0B    ADC A, $0B5E                       A:0840 X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09D1 AA          TAX                                A:139F X:000F Y:0180 D:0000 DB:7E PB:C1
$C1:09D2 7B          TDC                                A:139F X:139F Y:0180 D:0000 DB:7E PB:C1
$C1:09D3 A0 A0 94    LDY $94A0                          A:0000 X:139F Y:0180 D:0000 DB:7E PB:C1
$C1:09D6 A9 0A 00    LDA A, $000A                       A:0000 X:139F Y:94A0 D:0000 DB:7E PB:C1
; Kopioidaan 11 tavua osoitteesta CC:139F osoitteeseen 7E:94A0
$C1:09D9 54          MVN 7E CC                          A:000A X:139F Y:94A0 D:0000 DB:7E PB:C1
;TDC kopioi D:n A:ksi
$C1:09DC 7B          TDC                                A:FFFF X:13AA Y:94AB D:0000 DB:7E PB:C1
$C1:09DD E2 20       SEP $20                            A:0000 X:13AA Y:94AB D:0000 DB:7E PB:C1
; Perään nullterminator.
$C1:09DF 99 00 00    STA DB:($0000+y)     ;$7E:94AB     A:0000 X:13AA Y:94AB D:0000 DB:7E PB:C1
$C1:09E2 20 A9 01    JSR DB:$01A9         ;$7E:01A9     A:0000 X:13AA Y:94AB D:0000 DB:7E PB:C1
;Ks alla
$C1:09E5 A6 80       LDX [$00:D+$80]      ;$00:0080     A:0000 X:000B Y:94D0 D:0000 DB:7E PB:C1
$C1:09E7 BD 82 15    LDA DB:($1582+x)     ;$7E:1591     A:0000 X:000F Y:94D0 D:0000 DB:7E PB:C1
$C1:09EA 10 0F       BPL $09FB                          A:0002 X:000F Y:94D0 D:0000 DB:7E PB:C1
;
$C1:09FB A9 29       LDA A, $29                         A:0002 X:000F Y:94D0 D:0000 DB:7E PB:C1
$C1:09FD 85 98       STA [$00:D+$98]      ;$00:0098     A:0029 X:000F Y:94D0 D:0000 DB:7E PB:C1
$C1:09FF 7B          TDC                                A:0029 X:000F Y:94D0 D:0000 DB:7E PB:C1
$C1:0A00 A8          TAY                                A:0000 X:000F Y:94D0 D:0000 DB:7E PB:C1
$C1:0A01 A6 82       LDX [$00:D+$82]      ;$00:0082     A:0000 X:000F Y:0000 D:0000 DB:7E PB:C1
;
$C1:0A03 B9 A0 94    LDA DB:($94A0+y)     ;$7E:94A0     A:0000 X:0000 Y:0000 D:0000 DB:7E PB:C1
$C1:0A06 9D C6 0E    STA DB:($0EC6+x)     ;$7E:0EC6     A:00A4 X:0000 Y:0000 D:0000 DB:7E PB:C1
$C1:0A09 E8          INX                                A:00A4 X:0000 Y:0000 D:0000 DB:7E PB:C1
$C1:0A0A A5 98       LDA [$00:D+$98]      ;$00:0098     A:00A4 X:0001 Y:0000 D:0000 DB:7E PB:C1
$C1:0A0C 9D C6 0E    STA DB:($0EC6+x)     ;$7E:0EC7     A:0029 X:0001 Y:0000 D:0000 DB:7E PB:C1
$C1:0A0F E8          INX                                A:0029 X:0001 Y:0000 D:0000 DB:7E PB:C1
$C1:0A10 C8          INY                                A:0029 X:0002 Y:0000 D:0000 DB:7E PB:C1
$C1:0A11 C0 0A 00    CPY $000A                          A:0029 X:0002 Y:0001 D:0000 DB:7E PB:C1
$C1:0A14 D0 ED       BNE $0A03                          A:0029 X:0002 Y:0001 D:0000 DB:7E PB:C1
;
$C1:0A16 A9 5F       LDA A, $5F                         A:0029 X:0014 Y:000A D:0000 DB:7E PB:C1
$C1:0A18 9D C8 0E    STA DB:($0EC8+x)     ;$7E:0EDC     A:005F X:0014 Y:000A D:0000 DB:7E PB:C1
$C1:0A1B A5 98       LDA [$00:D+$98]      ;$00:0098     A:005F X:0014 Y:000A D:0000 DB:7E PB:C1
$C1:0A1D 9D C9 0E    STA DB:($0EC9+x)     ;$7E:0EDD     A:0029 X:0014 Y:000A D:0000 DB:7E PB:C1
$C1:0A20 7B          TDC                                A:0029 X:0014 Y:000A D:0000 DB:7E PB:C1
$C1:0A21 A8          TAY                                A:0000 X:0014 Y:000A D:0000 DB:7E PB:C1
$C1:0A22 A6 82       LDX [$00:D+$82]      ;$00:0082     A:0000 X:0014 Y:0000 D:0000 DB:7E PB:C1
;
$C1:0A24 B9 B0 94    LDA DB:($94B0+y)     ;$7E:94B0     A:0000 X:0000 Y:0000 D:0000 DB:7E PB:C1
$C1:0A27 9D 86 0E    STA DB:($0E86+x)     ;$7E:0E86     A:00FF X:0000 Y:0000 D:0000 DB:7E PB:C1
$C1:0A2A E8          INX                                A:00FF X:0000 Y:0000 D:0000 DB:7E PB:C1
$C1:0A2B A5 98       LDA [$00:D+$98]      ;$00:0098     A:00FF X:0001 Y:0000 D:0000 DB:7E PB:C1
$C1:0A2D 9D 86 0E    STA DB:($0E86+x)     ;$7E:0E87     A:0029 X:0001 Y:0000 D:0000 DB:7E PB:C1
$C1:0A30 E8          INX                                A:0029 X:0001 Y:0000 D:0000 DB:7E PB:C1
$C1:0A31 C8          INY                                A:0029 X:0002 Y:0000 D:0000 DB:7E PB:C1
$C1:0A32 C0 0B 00    CPY $000B                          A:0029 X:0002 Y:0001 D:0000 DB:7E PB:C1
$C1:0A35 D0 ED       BNE $0A24                          A:0029 X:0002 Y:0001 D:0000 DB:7E PB:C1
$C1:0A37 A6 80       LDX [$00:D+$80]      ;$00:0080     A:0029 X:0016 Y:000B D:0000 DB:7E PB:C1
$C1:0A39 BD 83 15    LDA DB:($1583+x)     ;$7E:1592     A:0029 X:000F Y:000B D:0000 DB:7E PB:C1
$C1:0A3C C2 20       REP $20                            A:0054 X:000F Y:000B D:0000 DB:7E PB:C1
$C1:0A3E 8D 99 94    STA DB:$9499         ;$7E:9499     A:0054 X:000F Y:000B D:0000 DB:7E PB:C1
$C1:0A41 20 74 01    JSR DB:$0174         ;$7E:0174     A:0054 X:000F Y:000B D:0000 DB:7E PB:C1


$C1:0174 DA          PHX                                A:0054 X:000F Y:000B D:0000 DB:7E PB:C1
$C1:0175 7B          TDC                                A:0054 X:000F Y:000B D:0000 DB:7E PB:C1
$C1:0176 AA          TAX                                A:0000 X:000F Y:000B D:0000 DB:7E PB:C1
;
$C1:0177 38          SEC                                A:0000 X:0000 Y:000B D:0000 DB:7E PB:C1
$C1:0178 AD 99 94    LDA DB:$9499         ;$7E:9499     A:0000 X:0000 Y:000B D:0000 DB:7E PB:C1
$C1:017B E9 0A 00    SBC A, $000A                       A:0054 X:0000 Y:000B D:0000 DB:7E PB:C1
$C1:017E 8D 99 94    STA DB:$9499         ;$7E:9499     A:004A X:0000 Y:000B D:0000 DB:7E PB:C1
$C1:0181 E8          INX                                A:004A X:0000 Y:000B D:0000 DB:7E PB:C1
$C1:0182 B0 F3       BCS $0177                          A:004A X:0001 Y:000B D:0000 DB:7E PB:C1
;
$C1:0184 18          CLC                                A:FFFA X:0009 Y:000B D:0000 DB:7E PB:C1
$C1:0185 AD 99 94    LDA DB:$9499         ;$7E:9499     A:FFFA X:0009 Y:000B D:0000 DB:7E PB:C1
$C1:0188 69 0A 00    ADC A, $000A                       A:FFFA X:0009 Y:000B D:0000 DB:7E PB:C1
$C1:018B CA          DEX                                A:0004 X:0009 Y:000B D:0000 DB:7E PB:C1
$C1:018C DA          PHX                                A:0004 X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:018D E2 20       SEP $20                            A:0004 X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:018F AA          TAX                                A:0004 X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:0190 BF 03 F9 CC LDA $CC:($F903+x)    ;$CC:F907     A:0004 X:0004 Y:000B D:0000 DB:7E PB:C1
$C1:0194 8D 9F 94    STA DB:$949F         ;$7E:949F     A:0077 X:0004 Y:000B D:0000 DB:7E PB:C1
$C1:0197 FA          PLX                                A:0077 X:0004 Y:000B D:0000 DB:7E PB:C1
$C1:0198 BF 03 F9 CC LDA $CC:($F903+x)    ;$CC:F90B     A:0077 X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:019C 8D 9E 94    STA DB:$949E         ;$7E:949E     A:007B X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:019F A9 FF       LDA A, $FF                         A:007B X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:01A1 8D 9D 94    STA DB:$949D         ;$7E:949D     A:00FF X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:01A4 8D 9C 94    STA DB:$949C         ;$7E:949C     A:00FF X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:01A7 FA          PLX                                A:00FF X:0008 Y:000B D:0000 DB:7E PB:C1
$C1:01A8 60          RTS                                A:00FF X:000F Y:000B D:0000 DB:7E PB:C1


; Tämä rutiini piirtää 7E:94A0 - osoitteessa olevan
; max. 16 merkkiä pitkän merkkijonon osoitteeseen
; 7E:94A0 (merkit) ja 7E:94B0 (värit).
$C1:01A9 C2 20       REP $20                            A:0000 X:13AA Y:94AB D:0000 DB:7E PB:C1
$C1:01AB A2 A0 94    LDX $94A0                          A:0000 X:13AA Y:94AB D:0000 DB:7E PB:C1
$C1:01AE A0 C0 94    LDY $94C0                          A:0000 X:94A0 Y:94AB D:0000 DB:7E PB:C1
$C1:01B1 A9 0F 00    LDA A, $000F                       A:0000 X:94A0 Y:94C0 D:0000 DB:7E PB:C1
;Kopioidaan 16 tavua osoitteesta 7E:94A0 osoitteeseen 7E:94C0
$C1:01B4 54          MVN 7E 7E                          A:000F X:94A0 Y:94C0 D:0000 DB:7E PB:C1
$C1:01B7 A2 1E 00    LDX $001E                          A:FFFF X:94B0 Y:94D0 D:0000 DB:7E PB:C1
$C1:01BA 9D A0 94    STA DB:($94A0+x)     ;$7E:94BE     A:FFFF X:001E Y:94D0 D:0000 DB:7E PB:C1
$C1:01BD CA          DEX                                A:FFFF X:001E Y:94D0 D:0000 DB:7E PB:C1
$C1:01BE CA          DEX                                A:FFFF X:001D Y:94D0 D:0000 DB:7E PB:C1
$C1:01BF 10 F9       BPL $01BA                          A:FFFF X:001C Y:94D0 D:0000 DB:7E PB:C1
$C1:01C1 7B          TDC                                A:FFFF X:FFFE Y:94D0 D:0000 DB:7E PB:C1
$C1:01C2 AA          TAX                                A:0000 X:FFFE Y:94D0 D:0000 DB:7E PB:C1
$C1:01C3 E2 20       SEP $20                            A:0000 X:0000 Y:94D0 D:0000 DB:7E PB:C1
;Ladataan merkki tavarasta.
$C1:01C5 BD C0 94    LDA DB:($94C0+x)     ;$7E:94C0     A:0000 X:0000 Y:94D0 D:0000 DB:7E PB:C1
;Jos tuli null-terminator vastaan, pois loopista
$C1:01C8 F0 2E       BEQ $01F8                          A:00A4 X:0000 Y:94D0 D:0000 DB:7E PB:C1
;$73 on kalpeampi "0" 8x8-fontissa
$C1:01CA C9 73       CMP A, $73                         
$C1:01CC B0 1C       BCS $01EA          -- jos arvo on >= $73
;$69 on .. hpmetrin pala ???
$C1:01CE C9 69       CMP A, $69                         
$C1:01D0 B0 0E       BCS $01E0          -- jos arvo on >= $69
;$40 on .. tyhjää
$C1:01D2 C9 40       CMP A, $40                         
$C1:01D4 90 14       BCC $01EA          -- jos arvo on < $40
$C1:01D6 18          CLC                -- arvo on < $40 (ERIVÄRINEN KIRJAIN)
$C1:01D7 69 40       ADC A, $40                         
$C1:01D9 9D A0 94    STA DB:($94A0+x)     ;$7E:94A0     
$C1:01DC A9 71       LDA A, $71         -- väri (?) $71
$C1:01DE 80 0F       BRA $01EF                          
$C1:01E0 18          CLC                -- arvo on $69..$72 (ERIVÄRINEN NUMERO)
$C1:01E1 69 17       ADC A, $17                         
$C1:01E3 9D A0 94    STA DB:($94A0+x)     ;$7E:94A0     
$C1:01E6 A9 72       LDA A, $72         -- väri (?) $72
$C1:01E8 80 05       BRA $01EF                          

; Kopioidaan symboli tuonne jonnekin
; 7E:9000:sta kasa näyttäisi olevan mapattu näytölle. H-DMA kopioi sitä VRAMiin.
$C1:01EA 9D A0 94    STA DB:($94A0+x)     ;$7E:94A0     A:00A4 X:0000 Y:94D0 D:0000 DB:7E PB:C1
$C1:01ED A9 FF       LDA A, $FF           -- väri (?) $FF
$C1:01EF 9D B0 94    STA DB:($94B0+x)     ;$7E:94B0     A:00FF X:0000 Y:94D0 D:0000 DB:7E PB:C1
$C1:01F2 E8          INX                                A:00FF X:0000 Y:94D0 D:0000 DB:7E PB:C1
;Joka tapauksessa käsitellään enintään 16 merkkiä
$C1:01F3 E0 10 00    CPX $0010                          A:00FF X:0001 Y:94D0 D:0000 DB:7E PB:C1
;Takaisin looppiin
$C1:01F6 D0 CD       BNE $01C5                          A:00FF X:0001 Y:94D0 D:0000 DB:7E PB:C1
;Loopin loppu!
$C1:01F8 60          RTS                                A:0000 X:000B Y:94D0 D:0000 DB:7E PB:C1



;;;;;;;;;;;;;;;;;;;;;

HuoneENMUODOSTUSskripti:
  
   MUISTIKARTTA:
   
     7F0000+?: word-taulu, jossa ???
     7F1100+x: word-taulu, jossa ???
     7F1180+x: word-taulu, objektien koodipointtereista.
     7F1B01+x: word-taulu, jossa ??? (alkaa nollasta)
     7F1B80+x: word-taulu, jossa ??? (alkaa nollasta)
     7F2000: byte - objektien määrä.
     7F2001: tästä eteenpäin koodia.

$C0:58AB A2 00 01    LDX $0100                          A:0100 X:00FF Y:00FF D:0100 DB:00 PB:C
$C0:58AE 86 4E       STX [$00:D+$4E]      ;$00:014E     A:0100 X:0100 Y:00FF D:0100 DB:00 PB:C
$C0:58B0 A2 00 19    LDX $1900                          A:0100 X:0100 Y:00FF D:0100 DB:00 PB:C
$C0:58B3 86 4B       STX [$00:D+$4B]      ;$00:014B     A:0100 X:1900 Y:00FF D:0100 DB:00 PB:C
$C0:58B5 A9 00       LDA A, $00                         A:0100 X:1900 Y:00FF D:0100 DB:00 PB:C
$C0:58B7 85 4D       STA [$00:D+$4D]      ;$00:014D     A:0100 X:1900 Y:00FF D:0100 DB:00 PB:C
$C0:58B9 20 F1 2D    JSR PB:$2DF1         ;$C0:2DF1     A:0100 X:1900 Y:00FF D:0100 DB:00 PB:C
; ^ $00:$1900 <- $0100 * $00
$C0:58BC A2 C0 15    LDX $15C0                          A:0180 X:0100 Y:00FF D:0100 DB:00 PB:C
$C0:58BF 86 4E       STX [$00:D+$4E]      ;$00:014E     A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58C1 A2 80 05    LDX $0580                          A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58C4 86 4B       STX [$00:D+$4B]      ;$00:014B     A:0180 X:0580 Y:00FF D:0100 DB:00 PB:C
$C0:58C6 A9 7F       LDA A, $7F                         A:0180 X:0580 Y:00FF D:0100 DB:00 PB:C
$C0:58C8 85 4D       STA [$00:D+$4D]      ;$00:014D     A:017F X:0580 Y:00FF D:0100 DB:00 PB:C
$C0:58CA 20 F1 2D    JSR PB:$2DF1         ;$C0:2DF1     A:017F X:0580 Y:00FF D:0100 DB:00 PB:C
; ^ $7F:$0580 <- $15C0 * $00
$C0:58CD A9 80       LDA A, $80                         A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58CF 85 74       STA [$00:D+$74]      ;$00:0174     A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58D1 85 75       STA [$00:D+$75]      ;$00:0175     A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58D3 85 76       STA [$00:D+$76]      ;$00:0176     A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58D5 85 77       STA [$00:D+$77]      ;$00:0177     A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58D7 A2 00 80    LDX $8000                          A:0180 X:15C0 Y:00FF D:0100 DB:00 PB:C
$C0:58DA 86 71       STX [$00:D+$71]      ;$00:0171     A:0180 X:8000 Y:00FF D:0100 DB:00 PB:C
$C0:58DC 64 73       STZ [$00:D+$73]      ;$00:0173     A:0180 X:8000 Y:00FF D:0100 DB:00 PB:C
; Haetaan scenessä olevien objektien määrä
$C0:58DE AF 00 20 7F LDA $7F:$2000        ;$7F:2000     A:0180 X:8000 Y:00FF D:0100 DB:00 PB:C
$C0:58E2 C2 20       REP $20                            A:010A X:8000 Y:00FF D:0100 DB:00 PB:C
$C0:58E4 29 FF 00    AND A, $00FF                       A:010A X:8000 Y:00FF D:0100 DB:00 PB:C
$C0:58E7 0A          ASL A                              A:000A X:8000 Y:00FF D:0100 DB:00 PB:C
; Tallennetaan maksimi talteen
$C0:58E8 85 BD       STA [$00:D+$BD]      ;$00:01BD     A:0014 X:8000 Y:00FF D:0100 DB:00 PB:C
$C0:58EA A2 00 00    LDX $0000                          A:0014 X:8000 Y:00FF D:0100 DB:00 PB:C
; Tästä alkaa skriptilooppi!
$C0:58ED 9E 01 1B    STZ DB:($1B01+x)     ;$00:1B01     A:0014 X:0000 Y:00FF D:0100 DB:00 PB:C
$C0:58F0 9E 80 1B    STZ DB:($1B80+x)     ;$00:1B80     A:0014 X:0000 Y:00FF D:0100 DB:00 PB:C
$C0:58F3 BD 00 11    LDA DB:($1100+x)     ;$00:1100     A:0014 X:0000 Y:00FF D:0100 DB:00 PB:C
$C0:58F6 30 26       BMI $591E                          A:0007 X:0000 Y:00FF D:0100 DB:00 PB:C
; Haetaan käsiteltävän objektin koodipointteri.
$C0:58F8 BD 80 11    LDA DB:($1180+x)     ;$00:1180     A:0007 X:0000 Y:00FF D:0100 DB:00 PB:C
; Käsiteltävän objektin numero talteen.
$C0:58FB 86 6D       STX [$00:D+$6D]      ;$00:016D     A:0140 X:0000 Y:00FF D:0100 DB:00 PB:C
$C0:58FD AA          TAX                                A:0140 X:0000 Y:00FF D:0100 DB:00 PB:C
$C0:58FE E2 20       SEP $20                            A:0140 X:0140 Y:00FF D:0100 DB:00 PB:C

;Haetaan opcode
;   X on osoite skriptiin skriptibufferissa
$C0:58FE E2 20       SEP $20                            A:0140 X:0140 Y:00FF D:0100 DB:00 PB:C
$C0:5900 BF 01 20 7F LDA $7F:($2001+x)    ;$7F:2141     A:0140 X:0140 Y:00FF D:0100 DB:00 PB:C
$C0:5904 F0 0F       BEQ $5915                          A:01B8 X:0140 Y:00FF D:0100 DB:00 PB:C
$C0:5906 9B          TXY                                A:01B8 X:0140 Y:00FF D:0100 DB:00 PB:C
;   osoite talteen Y:ksi
$C0:5907 C2 20       REP $20                            A:01B8 X:0140 Y:0140 D:0100 DB:00 PB:C
$C0:5909 29 FF 00    AND A, $00FF                       A:01B8 X:0140 Y:0140 D:0100 DB:00 PB:C
$C0:590C 0A          ASL A                              A:00B8 X:0140 Y:0140 D:0100 DB:00 PB:C
$C0:590D AA          TAX                                A:0170 X:0140 Y:0140 D:0100 DB:00 PB:C
$C0:590E E2 20       SEP $20                            A:0170 X:0170 Y:0140 D:0100 DB:00 PB:C
; Nyt A:ssa on opcode, X:ssä A*2 ja Y:ssä skriptiosoite
$C0:5910 FC 6E 5D    JSR [PB:word[PB:$5D6E+x]] ;$C0:3557 A:0170 X:0170 Y:0140 D:0100 DB:00 PB:
; Tuloksena X:ssä on uusi skriptiosoite.
$C0:5913 80 EB       BRA $5900                          A:01F8 X:0144 Y:0140 D:0100 DB:00 PB:C
;^Haetaan seuraava opcode
; Loppu on 5915:ssä 

; Opcodeja:
;   $16:
;     $D9 <- tavu
;     $DB <- tavu
;     Hakee tavun
;       Jos negatiivinen:
;         $C3 <- X
;         $DD <- A & $7F
;         $D9 <- [#$7F0000 + ($D9 * 2)]
;       Muuten:
;          ?
;     Kutsuu rutiinia [#$C06467 + ($DD * 2)]
;      .... 
;   $57: 
;     $8D <- $6D
;     $D9 <- $00
;     ....
;   $B8: 3
;     $2B <- long
;   $EA: 2
;     $7E29AE <- tavu
;     $001E01 <- se sama tavu
;     $001E00 <- $10
;     $C7 <- X
;     CALL #$C70004
;     X <- $C7+1




;Opcode-loopin loppu.
$C0:5915 C2 20       REP $20                            A:0100 X:014F Y:014E D:0100 DB:00 PB:C
$C0:5917 E8          INX                                A:0100 X:014F Y:014E D:0100 DB:00 PB:C
$C0:5918 8A          TXA                                A:0100 X:0150 Y:014E D:0100 DB:00 PB:C
; Haetaan käsiteltävän objektin numero.
$C0:5919 A6 6D       LDX [$00:D+$6D]      ;$00:016D     A:0150 X:0150 Y:014E D:0100 DB:00 PB:C
$C0:591B 9D 80 11    STA DB:($1180+x)     ;$00:1180     A:0150 X:0000 Y:014E D:0100 DB:00 PB:C
$C0:591E E8          INX                                A:0150 X:0000 Y:014E D:0100 DB:00 PB:C
$C0:591F E8          INX                                A:0150 X:0001 Y:014E D:0100 DB:00 PB:C
; Jos se ei ole vielä maksimi,
$C0:5920 E4 BD       CPX [$00:D+$BD]      ;$00:01BD     A:0150 X:0002 Y:014E D:0100 DB:00 PB:C
; Niin käsitellään seuraava.
$C0:5922 D0 C9       BNE $58ED                          A:0150 X:0002 Y:014E D:0100 DB:00 PB:C
; Lopulta kaikki on käsitelty.
$C0:5924 E2 20       SEP $20                            A:01AF X:0014 Y:01A4 D:0100 DB:00 PB:C0 S:06FB P:envmxdIZC HC:484 VC:131 00
$C0:5926 82 9A 44    BRL $9DC3                          A:01AF X:0014 Y:01A4 D:0100 DB:00 PB:C0 S:06FB P:envMxdIZC HC:502 VC:131 00


; Huoneen sisällä looppi

;Sub
$C0:5A93 A5 68       LDA [$00:D+$68]      ;$00:0168     A:0080 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:eNvMXdizc HC:1256 VC:255 00
$C0:5A95 85 67       STA [$00:D+$67]      ;$00:0167     A:0005 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envMXdizc HC:1276 VC:255 00
; $67 <- tavuja jäljellä
$C0:5A97 C2 20       REP $20                            A:0005 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envMXdizc HC:1296 VC:255 00
; A <- objektin koodipointteri
$C0:5A99 BD 80 11    LDA DB:($1180+x)     ;$00:118A     A:0005 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envmXdizc HC:1314 VC:255 00
; $6D <- objektin numero
$C0:5A9C 86 6D       STX [$00:D+$6D]      ;$00:016D     A:01C4 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envmXdizc HC:1348 VC:255 00
$C0:5A9E C2 10       REP $10                            A:01C4 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envmXdizc HC:000 VC:256 00
$C0:5AA0 AA          TAX                                A:01C4 X:000A Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:018 VC:256 00
$C0:5AA1 E2 20       SEP $20                            A:01C4 X:01C4 Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:030 VC:256 00
; Looppi. Haetaan opcode.
$C0:5AA3 BF 01 20 7F LDA $7F:($2001+x)    ;$7F:21C5     A:01C4 X:01C4 Y:000E D:0100 DB:00 PB:C0 S:06F9 P:envMxdizc HC:048 VC:256 00
$C0:5AA7 9B          TXY                                A:01B0 X:01C4 Y:000E D:0100 DB:00 PB:C0 S:06F9 P:eNvMxdizc HC:080 VC:256 00
$C0:5AA8 C2 20       REP $20                            A:01B0 X:01C4 Y:01C4 D:0100 DB:00 PB:C0 S:06F9 P:envMxdizc HC:092 VC:256 00
$C0:5AAA 29 FF 00    AND A, $00FF                       A:01B0 X:01C4 Y:01C4 D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:110 VC:256 00
$C0:5AAD 0A          ASL A                              A:00B0 X:01C4 Y:01C4 D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:128 VC:256 00
$C0:5AAE AA          TAX                                A:0160 X:01C4 Y:01C4 D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:140 VC:256 00
$C0:5AAF E2 20       SEP $20                            A:0160 X:0160 Y:01C4 D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:152 VC:256 00
$C0:5AB1 FC 6E 5D    JSR [PB:word[PB:$5D6E+x]] ;$C0:3002 A:0160 X:0160 Y:01C4 D:0100 DB:00 PB:C0 S:06F9 P:envMxdizc HC:170 VC:256 00
;^Käsitellään opcode.
$C0:5AB4 90 04       BCC $5ABA                          A:0080 X:01C4 Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envMxdizc HC:300 VC:257 00
$C0:5AB6 C6 67       DEC [$00:D+$67]      ;$00:0167     A:01E3 X:01E3 Y:01FE D:0100 DB:00 PB:C0 S:06F9 P:envMxdizC HC:926 VC:001 00
$C0:5AB8 D0 E9       BNE $5AA3                          A:01E3 X:01E3 Y:01FE D:0100 DB:00 PB:C0 S:06F9 P:envMxdizC HC:960 VC:001 00
$C0:5ABA C2 20       REP $20                            A:0080 X:01C4 Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envMxdizc HC:318 VC:257 00
$C0:5ABC 8A          TXA                                A:0080 X:01C4 Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:336 VC:257 00
; Objektin numero takaisin X:ään
$C0:5ABD A6 6D       LDX [$00:D+$6D]      ;$00:016D     A:01C4 X:01C4 Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:348 VC:257 00
; Objektin koodipointteri talteen
$C0:5ABF 9D 80 11    STA DB:($1180+x)     ;$00:118A     A:01C4 X:000A Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:376 VC:257 00
$C0:5AC2 E2 30       SEP $30                            A:01C4 X:000A Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envmxdizc HC:410 VC:257 00
$C0:5AC4 60          RTS                                A:01C4 X:000A Y:000A D:0100 DB:00 PB:C0 S:06F9 P:envMXdizc HC:428 VC:257 00
;endsub



[1B0000]
0000: D200 1001 2000 F102 D0B8 00BA 00FC 4AA1 027E 004A 1020 0100 014A 1105 0000 1600
0020: 6101 0003 101A 1660 0000 000E 5600 ED01 5680 0062 00E0 B103 0019 0000 0000 98C8
0040: 414A 7E02 1000 004A 7F05 004E 8F02 007E 1200 00A0 00A0 0104 8000 0130 4E80 297E
0060: 0B08 0000 8001 204E 232C 7E00 3200
006E: Crono0000Marle00Lu00cca00Robo400000Frog4200y08la001E00gus0000Epoch00

Miten tämä taulu toimii, on täysin mysteeri.





http://www.uct2.net/epoch/Zeal-Mouser_X-1024x768.gif
http://www.uct2.net/epoch/MagusCT%20-%20CT%20Cast.gif
